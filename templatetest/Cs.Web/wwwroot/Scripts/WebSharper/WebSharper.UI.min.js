(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Var$1=c.Var$1||{};B=c.Updates=c.Updates||{};C=c.FromView=c.FromView||{};D=c.ViewBuilder=c.ViewBuilder||{};E=c.Submitter=c.Submitter||{};F=c.Key=c.Key||{};G=c.Model=c.Model||{};H=c.Serializer=c.Serializer||{};I=c.Storage=c.Storage||{};J=I.ArrayStorage=I.ArrayStorage||{};K=I.LocalStorageBackend=I.LocalStorageBackend||{};L=c.ListModel=c.ListModel||{};M=c.ListModels=c.ListModels||{};N=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};O=c.ReactiveExtensions=c.ReactiveExtensions||{};P=c.DoubleInterpolation=c.DoubleInterpolation||{};Q=c.Interpolation=c.Interpolation||{};R=c.Easing=c.Easing||{};S=c.Easings=c.Easings||{};T=c.An=c.An||{};U=c.Anims=c.Anims||{};V=c.Trans=c.Trans||{};W=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};X=b&&b.Web;Y=X&&X.Control;Z=c.OnAfterRenderControl=c.OnAfterRenderControl||{};_0=c.AnimatedAttrNode=c.AnimatedAttrNode||{};_1=c.DynamicAttrNode=c.DynamicAttrNode||{};_2=c.AttrProxy=c.AttrProxy||{};_3=c.Client=c.Client||{};_4=_3.Attrs=_3.Attrs||{};_5=_4.Dyn=_4.Dyn||{};_6=c.Attrs=c.Attrs||{};_7=c.CheckedInput=c.CheckedInput||{};_8=c.BindVar=c.BindVar||{};_9=c.AttrModule=c.AttrModule||{};_=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};$=_3.Settings=_3.Settings||{};ba=c.DocElemNode=c.DocElemNode||{};bb=_3.Docs=_3.Docs||{};bc=bb.DomNodes=bb.DomNodes||{};bd=bb.NodeSet=bb.NodeSet||{};be=bb.RunState=bb.RunState||{};bf=c.Docs=c.Docs||{};bg=c.Doc=c.Doc||{};bh=c.Elt=c.Elt||{};bi=_3.EltUpdater=_3.EltUpdater||{};bj=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bk=_3.Templates=_3.Templates||{};bl=bk.Prepare=bk.Prepare||{};bm=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bn=c.Flow=c.Flow||{};bo=c.FlowBuilder=c.FlowBuilder||{};bp=c.HtmlModule=c.HtmlModule||{};bq=bp.attr=bp.attr||{};br=c.Router=c.Router||{};bs=c.Route=c.Route||{};bt=c.Routing=c.Routing||{};bu=c.RouteMap=c.RouteMap||{};bv=c.Input=c.Input||{};bw=bv.MousePosSt=bv.MousePosSt||{};bx=bv.MouseBtnSt=bv.MouseBtnSt||{};by=bv.Mouse=bv.Mouse||{};bz=bv.KeyListenerSt=bv.KeyListenerSt||{};bA=bv.Keyboard=bv.Keyboard||{};bB=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bC=b&&b.List;bD=b&&b.Arrays;bE=b&&b.Enumerator;bF=b&&b.Strings;bG=b&&b.Char;bH=b&&b.Collections;bI=bH&&bH.HashSet;bJ=b&&b.Seq;bK=b&&b.Runtime;bL=b&&b.Unchecked;bM=a.console;bN=b&&b.Concurrency;bO=bH&&bH.Map;bP=bH&&bH.FSharpMap;bQ=b&&b.Operators;bR=b&&b.Queue;bS=b&&b.Lazy;bT=bH&&bH.Dictionary;bU=a.JSON;bV=b&&b.Numeric;bW=a.Node;bX=b&&b.Slice;bY=b&&b.Sitelets;bZ=bY&&bY.RouterModule;b0=bY&&bY.Route;b1=b&&b.Utils;b2=b&&b.Option;d.mapInPlace=function(b3,b4){var b5,b6;for(b5=0,b6=b4.length-1;b5<=b6;b5++)b4[b5]=b3(b4[b5]);return b4;};d.ofSeqNonCopying=function(b3){var b4,b5;if(b3 instanceof a.Array)return b3;else if(b3 instanceof bC.T)return bD.ofList(b3);else if(b3===null)return[];else{b4=[];b5=bE.Get(b3);try{while(b5.MoveNext())b4.push(b5.Current());return b4;}finally{if(typeof b5=="object"&&"Dispose"in b5)b5.Dispose();}}};d.MapTreeReduce=function(b3,b4,b5,b6){var b7;function b8(b9){return function(b_){var b$,ca;return b_<=0?b4:b_===1&&(b9>=0&&b9<b7)?b3(bD.get(b6,b9)):(ca=b_/2>>0,b5((b8(b9))(ca),(b8(b9+ca))(b_-ca)));};}b7=bD.length(b6);return(b8(0))(b7);};d.TreeReduce=function(b3,b4,b5){var b6;function b7(b8){return function(b9){var b_,b$;return b9<=0?b3:b9===1&&(b8>=0&&b8<b6)?bD.get(b5,b8):(b$=b9/2>>0,b4((b7(b8))(b$),(b7(b8+b$))(b9-b$)));};}b6=bD.length(b5);return(b7(0))(b6);};e.isBlank=function(b3){return bF.forall(bG.IsWhiteSpace,b3);};f.maybeReplaceFirst=function(b3,b4,b5){var b6;b6=[false];return bC.map(function(b7){var b8;return!b6[0]&&b3(b7)?(b8=b4(b7),b8==null?b7:b8.$0):b7;},b5);};f.replaceFirst=function(b3,b4,b5){var b6;b6=[false];return bC.map(function(b7){return!b6[0]&&b3(b7)?b4(b7):b7;},b5);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(b3){o.$cctor();o.counter=b3;};i.Filter=function(b3,b4){return new bI.New$2(bD.filter(b3,i.ToArray(b4)));};i.Intersect=function(b3,b4){var b5;b5=new bI.New$2(i.ToArray(b3));b5.IntersectWith(i.ToArray(b4));return b5;};i.Except=function(b3,b4){var b5;b5=new bI.New$2(i.ToArray(b4));b5.ExceptWith(i.ToArray(b3));return b5;};i.ToArray=function(b3){var b4;b4=bD.create(b3.Count(),void 0);b3.CopyTo(b4);return b4;};j.ToValueArray=function(b3){var b4;b4=bD.create(b3.count,void 0);bJ.iteri(function(b5,b6){return bD.set(b4,b5,b6.V);},b3);return b4;};j.ToKeyArray=function(b3){var b4;b4=bD.create(b3.count,void 0);bJ.iteri(function(b5,b6){return bD.set(b4,b5,b6.K);},b3);return b4;};l=g.Slot=bK.Class({GetHashCode:function(){return bL.Hash(this.key(this.value));},Equals:function(b3){return bL.Equals(this.key(this.value),this.key(b3.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bK.Ctor(function(b3,b4){k.New.call(this);this.key=b3;this.value=b4;},l);l.Create=function(b3,b4){return new l.New(b3,b4);};m.OnError=function(b3){return bM.log("WebSharper UI: Uncaught asynchronous exception",b3);};m.StartTo=function(b3,b4){bN.StartWithContinuations(b3,b4,function(b5){m.OnError(b5);},a.ignore,null);};n.StartProcessor=function(b3){var b4;function b5(){var b6;b6=null;return bN.Delay(function(){return bN.Bind(b3,function(){var b7;b7=b4[0];return bL.Equals(b7,1)?(b4[0]=0,bN.Zero()):bL.Equals(b7,2)?(b4[0]=1,b5()):bN.Zero();});});}b4=[0];return function(){var b6;b6=b4[0];if(bL.Equals(b6,0)){b4[0]=1;bN.Start(b5(),null);}else bL.Equals(b6,1)?b4[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(b3){var b4;b4=b3.length;return b4===0?{$:0}:b4===1?{$:1,$0:bD.get(b3,0)}:{$:3,$0:b3.slice()};};p.ToArray=function(b3){var b4;function b5(b6){var b7,b8;while(true)if(b6.$==1)return b4.push(b6.$0);else if(b6.$==2){b7=b6.$1;b8=b6.$0;b5(b8);b6=b7;}else return b6.$==3?bD.iter(function(b9){b4.push(b9);},b6.$0):null;}b4=[];b5(b3);return b4.slice(0);};p.Single=function(b3){return{$:1,$0:b3};};p.Concat=function(b3){var b4;b4=d.ofSeqNonCopying(b3);return d.TreeReduce(p.Empty(),p.Append,b4);};p.Append=function(b3,b4){return b3.$==0?b4:b4.$==0?b3:{$:2,$0:b3,$1:b4};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.ParseHTMLIntoFakeRoot=function(b3){var b4,b5,b6,b7,b8;function b9(b_,b$){var ca;while(true)if(b$===0)return b_;else{ca=b$;b_=b_.lastChild;b$=ca-1;}}b4=self.document.createElement("div");return!r.rhtml().test(b3)?(b4.appendChild(self.document.createTextNode(b3)),b4):(b5=(b6=r.rtagName().exec(b3),bL.Equals(b6,null)?"":bD.get(b6,1).toLowerCase()),(b7=(b8=(r.wrapMap())[b5],b8?b8:r.defaultWrap()),(b4.innerHTML=b7[1]+b3.replace(r.rxhtmlTag(),"<$1></$2>")+b7[2],b9(b4,b7[0]))));};r.defaultWrap=function(){s.$cctor();return s.defaultWrap;};r.wrapMap=function(){s.$cctor();return s.wrapMap;};r.rhtml=function(){s.$cctor();return s.rhtml;};r.rtagName=function(){s.$cctor();return s.rtagName;};r.rxhtmlTag=function(){s.$cctor();return s.rxhtmlTag;};r.IterSelector=function(b3,b4,b5){var b6,b7,b8;b6=b3.querySelectorAll(b4);for(b7=0,b8=b6.length-1;b7<=b8;b7++)b5(b6[b7]);};r.ChildrenArray=function(b3){var b4,b5,b6;b4=[];for(b5=0,b6=b3.childNodes.length-1;b5<=b6;b5++)b4.push(b3.childNodes[b5]);return b4;};r.RemoveClass=function(b3,b4){var b5;r.setClass(b3,(b5=r.clsRE(b4),r.getClass(b3).replace(b5,function(b6,b7,b8){return b7===""||b8===""?"":" ";})));};r.AddClass=function(b3,b4){var b5;b5=r.getClass(b3);if(b5==="")r.setClass(b3,b4);else!r.clsRE(b4).test(b5)?r.setClass(b3,b5+" "+b4):void 0;};r.setClass=function(b3,b4){if(b3 instanceof a.SVGElement)b3.setAttribute("class",b4);else b3.className=b4;};r.getClass=function(b3){return b3 instanceof a.SVGElement?b3.getAttribute("class"):b3.className;};r.clsRE=function(b3){return new a.RegExp("(\\s+|^)"+b3+"(?:\\s+"+b3+")*(\\s+|$)","g");};r.InsertAt=function(b3,b4,b5){var b6;if(!(b5.parentNode===b3&&b4===(b6=b5.nextSibling,bL.Equals(b6,null)?null:b6)))b3.insertBefore(b5,b4);};r.RemoveNode=function(b3,b4){if(b4.parentNode===b3)b3.removeChild(b4);};s.$cctor=function(){var b3;s.$cctor=a.ignore;s.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");s.rtagName=new a.RegExp("<([\\w:]+)");s.rhtml=new a.RegExp("<|&#?\\w+;");s.wrapMap=(b3=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:b3,tbody:b3,tfoot:b3,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});s.defaultWrap=[0,"",""];};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(b3,b4){return t.Look(bC.ofSeq(b4),b3);};t.Look=function(b3,b4){var b5,b6;switch(b4.$==2?(b5=b4.$0,0):b4.$==0?b3.$==1?(b5=[b3.$0,b3.$1,b4.$0],1):2:2){case 0:return{$:0,$0:b5,$1:b3};case 1:b6=bO.TryFind(b5[0],b5[2]);return b6==null?u.NotFound:t.Look(b5[1],b6.$0);case 2:return u.NotFound;}};t.ToArray=function(b3){var b4;b4=[];t.Map(function(){return function(b5){return b4.push(b5);};},b3);return b4.slice(0);};t.Mapi=function(b3,b4){var b5;function b6(){var b7;b7=b5[0];b5[0]=b7+1;return b7;}b5=[0];return t.Map(function(b7){return b3(b6(),b7);},b4);};t.Map=function(b3,b4){return t.MapLoop(bC.T.Empty,b3,b4);};t.MapLoop=function(b3,b4,b5){return b5.$==1?{$:1}:b5.$==2?{$:2,$0:(b4(b3))(b5.$0)}:t.TrieBranch(bO.Map(function(b6,b7){return t.MapLoop(bC.append(b3,bC.ofArray([b6])),b4,b7);},b5.$0));};t.Merge=function(b3){var b4,b5,b6;b4=d.ofSeqNonCopying(b3);b5=bD.length(b4);return b5===0?{$:1,$0:{$:1}}:b5===1?{$:1,$0:bD.get(b4,0)}:bD.exists(t.IsLeaf,b4)?null:(b6=t.MergeMaps(t.Merge,bJ.choose(function(b7){return b7.$==0?{$:1,$0:b7.$0}:null;},b4)),b6==null?null:{$:1,$0:t.TrieBranch(b6.$0)});};t.IsLeaf=function(b3){return b3.$==2;};t.MergeMaps=function(b3,b4){var b5,b6;function b7(b8,b9){var b_;b_=b3(b9);return b_==null?null:{$:1,$0:[b8,b_.$0]};}b5=t.AllSome(bJ.map(function(b8){return b7(b8[0],b8[1]);},bO.ToSeq((b6=bJ.collect(bO.ToSeq,b4),bJ.fold(function(b8,b9){return t.MultiAdd(b9[0],b9[1],b8);},new bP.New([]),b6)))));return b5==null?null:{$:1,$0:bO.OfArray(bD.ofSeq(b5.$0))};};t.AllSome=function(b3){var b4,b5,b6,b7;b5=bE.Get(b3);b6=bK.MarkResizable([]);b4=true;while(b4&&b5.MoveNext()){b7=b5.Current();if(b7!=null&&b7.$==1)b6.push(b7.$0);else b4=false;}return b4?{$:1,$0:b6.slice()}:null;};t.MultiAdd=function(b3,b4,b5){return b5.Add$1(b3,new bC.T({$:1,$0:b4,$1:t.MultiFind(b3,b5)}));};t.MultiFind=function(b3,b4){var b5;b5=bO.TryFind(b3,b4);return b5==null?bC.T.Empty:b5.$0;};t.Prefix=function(b3,b4){return t.TrieBranch(new bP.New(bC.ofArray([[b3,b4]])));};t.Leaf=function(b3){return{$:2,$0:b3};};t.TrieBranch=function(b3){return b3.get_IsEmpty()?{$:1}:{$:0,$0:b3};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(b3){var b4,b5,b6,b7,b8;b5=b3.s;if(b5==null||(b5!=null&&b5.$==2?(b4=b5.$1,false):b5!=null&&b5.$==3?(b4=b5.$1,false):true))void 0;else{b3.s=null;for(b6=0,b7=bD.length(b4)-1;b6<=b7;b6++){b8=bD.get(b4,b6);if(typeof b8=="object")(function(b9){w.Obsolete(b9);}(b8));else b8();}}};w.New=function(b3){return{s:b3};};w.MapAsync=function(b3,b4){var b5;b5=w.New({$:3,$0:[],$1:[]});w.When(b4,function(b6){m.StartTo(b3(b6),function(b7){w.MarkDone(b5,b4,b7);});},b5);return b5;};w.SnapshotOn=function(b3,b4){var b5;function b6(b7){var b8,b9,b_;if(!(b8=b5.s,b8!=null&&b8.$==0||b8!=null&&b8.$==2)){b9=w.ValueAndForever(b3);b_=w.ValueAndForever(b4);if(b9!=null&&b9.$==1)b_!=null&&b_.$==1?b9.$0[1]||b_.$0[1]?w.MarkForever(b5,b_.$0[0]):w.MarkReady(b5,b_.$0[0]):void 0;}}b5=w.New({$:3,$0:[],$1:[]});w.When(b3,b6,b5);w.WhenReady(b4,b6);return b5;};w.Map3=function(b3,b4,b5,b6){var b7,b8,b9,b_;function b$(ca){var cb,cc,cd,ce;if(!(cb=b_.s,cb!=null&&cb.$==0||cb!=null&&cb.$==2)){cc=w.ValueAndForever(b4);cd=w.ValueAndForever(b5);ce=w.ValueAndForever(b6);if(cc!=null&&cc.$==1)cd!=null&&cd.$==1?ce!=null&&ce.$==1?cc.$0[1]&&cd.$0[1]&&ce.$0[1]?w.MarkForever(b_,b3(cc.$0[0],cd.$0[0],ce.$0[0])):w.MarkReady(b_,b3(cc.$0[0],cd.$0[0],ce.$0[0])):void 0:void 0;}}b7=b4.s;b8=b5.s;b9=b6.s;return b7!=null&&b7.$==0?b8!=null&&b8.$==0?b9!=null&&b9.$==0?w.New({$:0,$0:b3(b7.$0,b8.$0,b9.$0)}):w.Map3Opt1(b3,b7.$0,b8.$0,b6):b9!=null&&b9.$==0?w.Map3Opt2(b3,b7.$0,b9.$0,b5):w.Map3Opt3(b3,b7.$0,b5,b6):b8!=null&&b8.$==0?b9!=null&&b9.$==0?w.Map3Opt4(b3,b8.$0,b9.$0,b4):w.Map3Opt5(b3,b8.$0,b4,b6):b9!=null&&b9.$==0?w.Map3Opt6(b3,b9.$0,b4,b5):(b_=w.New({$:3,$0:[],$1:[]}),(w.When(b4,b$,b_),w.When(b5,b$,b_),w.When(b6,b$,b_),b_));};w.Map3Opt6=function(b3,b4,b5,b6){return w.Map2(function(b7,b8){return b3(b7,b8,b4);},b5,b6);};w.Map3Opt5=function(b3,b4,b5,b6){return w.Map2(function(b7,b8){return b3(b7,b4,b8);},b5,b6);};w.Map3Opt4=function(b3,b4,b5,b6){return w.Map(function(b7){return b3(b7,b4,b5);},b6);};w.Map3Opt3=function(b3,b4,b5,b6){return w.Map2(function(b7,b8){return b3(b4,b7,b8);},b5,b6);};w.Map3Opt2=function(b3,b4,b5,b6){return w.Map(function(b7){return b3(b4,b7,b5);},b6);};w.Map3Opt1=function(b3,b4,b5,b6){return w.Map(function(b7){return b3(b4,b5,b7);},b6);};w.Map2Unit=function(b3,b4){var b5,b6,b7;function b8(){var b9,b_,b$;if(!(b9=b7.s,b9!=null&&b9.$==0||b9!=null&&b9.$==2)){b_=w.ValueAndForever(b3);b$=w.ValueAndForever(b4);if(b_!=null&&b_.$==1)b$!=null&&b$.$==1?b_.$0[1]&&b$.$0[1]?w.MarkForever(b7,null):w.MarkReady(b7,null):void 0;}}b5=b3.s;b6=b4.s;return b5!=null&&b5.$==0?b6!=null&&b6.$==0?w.New({$:0,$0:null}):b4:b6!=null&&b6.$==0?b3:(b7=w.New({$:3,$0:[],$1:[]}),(w.When(b3,b8,b7),w.When(b4,b8,b7),b7));};w.Map2=function(b3,b4,b5){var b6,b7,b8;function b9(b_){var b$,ca,cb;if(!(b$=b8.s,b$!=null&&b$.$==0||b$!=null&&b$.$==2)){ca=w.ValueAndForever(b4);cb=w.ValueAndForever(b5);if(ca!=null&&ca.$==1)cb!=null&&cb.$==1?ca.$0[1]&&cb.$0[1]?w.MarkForever(b8,b3(ca.$0[0],cb.$0[0])):w.MarkReady(b8,b3(ca.$0[0],cb.$0[0])):void 0;}}b6=b4.s;b7=b5.s;return b6!=null&&b6.$==0?b7!=null&&b7.$==0?w.New({$:0,$0:b3(b6.$0,b7.$0)}):w.Map2Opt1(b3,b6.$0,b5):b7!=null&&b7.$==0?w.Map2Opt2(b3,b7.$0,b4):(b8=w.New({$:3,$0:[],$1:[]}),(w.When(b4,b9,b8),w.When(b5,b9,b8),b8));};w.Map2Opt2=function(b3,b4,b5){return w.Map(function(b6){return b3(b6,b4);},b5);};w.Map2Opt1=function(b3,b4,b5){return w.Map(function(b6){return b3(b4,b6);},b5);};w.MapCachedBy=function(b3,b4,b5,b6){return w.Map(function(b7){var b8,b9,b_;b8=b4[0];return b8!=null&&b8.$==1&&(b3(b7,b8.$0[0])&&(b9=[b8.$0[0],b8.$0[1]],true))?b9[1]:(b_=b5(b7),(b4[0]={$:1,$0:[b7,b_]},b_));},b6);};w.Copy=function(b3){var b4,b5,b6;b4=b3.s;return b4==null?b3:b4!=null&&b4.$==2?(b5=w.New({$:2,$0:b4.$0,$1:[]}),(w.WhenObsolete(b3,b5),b5)):b4!=null&&b4.$==3?(b6=w.New({$:3,$0:[],$1:[]}),(w.When(b3,function(b7){w.MarkDone(b6,b3,b7);},b6),b6)):b3;};w.WithInitOption=function(b3){var b4,b5,b6;b4=b3.s;return b4==null?w.New(null):b4!=null&&b4.$==2?(b5=w.New({$:2,$0:{$:1,$0:b4.$0},$1:[]}),(w.WhenObsolete(b3,b5),b5)):b4!=null&&b4.$==3?(b6=w.New({$:2,$0:null,$1:[]}),(w.When(b3,function(){w.Obsolete(b6);},b6),b6)):w.New({$:0,$0:{$:1,$0:b4.$0}});};w.WithInit=function(b3,b4){var b5,b6,b7;b5=b4.s;return b5==null?b4:b5!=null&&b5.$==2?(b6=w.New({$:2,$0:b5.$0,$1:[]}),(w.WhenObsolete(b4,b6),b6)):b5!=null&&b5.$==3?(b7=w.New({$:2,$0:b3,$1:[]}),(w.When(b4,function(){w.Obsolete(b7);},b7),b7)):b4;};w.Map=function(b3,b4){var b5,b6;b5=b4.s;return b5!=null&&b5.$==0?w.New({$:0,$0:b3(b5.$0)}):(b6=w.New({$:3,$0:[],$1:[]}),(w.When(b4,function(b7){w.MarkDone(b6,b4,b3(b7));},b6),b6));};w.Sequence=function(b3){var b4,b5,b6;function b7(b8){var b9;if(b6[0]===0){b9=bD.map(function(b_){var b$;b$=b_.s;return b$!=null&&b$.$==0?b$.$0:b$!=null&&b$.$==2?b$.$0:bQ.FailWith("value not found by View.Sequence");},b4);if(bD.forall(function(b_){var b$;b$=b_.s;return b$!=null&&b$.$==0;},b4))w.MarkForever(b5,b9);else w.MarkReady(b5,b9);}else b6[0]=b6[0]-1;}b4=bD.ofSeq(b3);return b4.length==0?w.New({$:0,$0:[]}):(b5=w.New({$:3,$0:[],$1:[]}),(b6=[bD.length(b4)-1],(bD.iter(function(b8){w.When(b8,b7,b5);},b4),b5)));};w.CreateForeverAsync=function(b3){var b4;b4=w.New({$:3,$0:[],$1:[]});m.StartTo(b3,function(b5){w.MarkForever(b4,b5);});return b4;};w.JoinInner=function(b3){var b4;b4=w.New({$:3,$0:[],$1:[]});w.When(b3,function(b5){var b6;b6=b5();w.When(b6,function(b7){var b8,b9;if((b8=b6.s,b8!=null&&b8.$==0)&&(b9=b3.s,b9!=null&&b9.$==0))w.MarkForever(b4,b7);else w.MarkReady(b4,b7);},b4);w.WhenObsolete(b3,b6);},b4);return b4;};w.Join=function(b3){var b4;b4=w.New({$:3,$0:[],$1:[]});w.When(b3,function(b5){var b6;b6=b5();w.When(b6,function(b7){var b8,b9;if((b8=b6.s,b8!=null&&b8.$==0)&&(b9=b3.s,b9!=null&&b9.$==0))w.MarkForever(b4,b7);else w.MarkReady(b4,b7);},b4);},b4);return b4;};w.ValueAndForever=function(b3){var b4;b4=b3.s;return b4!=null&&b4.$==0?{$:1,$0:[b4.$0,true]}:b4!=null&&b4.$==2?{$:1,$0:[b4.$0,false]}:null;};w.WhenObsoleteRun=function(b3,b4){var b5;b5=b3.s;if(b5==null)b4();else b5!=null&&b5.$==2?b5.$1.push(b4):b5!=null&&b5.$==3?b5.$1.push(b4):void 0;};w.WhenObsolete=function(b3,b4){var b5;b5=b3.s;if(b5==null)w.Obsolete(b4);else b5!=null&&b5.$==2?w.EnqueueSafe(b5.$1,b4):b5!=null&&b5.$==3?w.EnqueueSafe(b5.$1,b4):void 0;};w.WhenReady=function(b3,b4){var b5,b6;b6=b3.s;switch(b6!=null&&b6.$==2?(b5=b6.$0,0):b6==null?1:b6!=null&&b6.$==3?2:(b5=b6.$0,0)){case 0:b4(b5);break;case 1:null;break;case 2:b6.$0.push(b4);break;}};w.WhenRun=function(b3,b4,b5){var b6;b6=b3.s;if(b6==null)b5();else b6!=null&&b6.$==2?(b6.$1.push(b5),b4(b6.$0)):b6!=null&&b6.$==3?(b6.$0.push(b4),b6.$1.push(b5)):b4(b6.$0);};w.When=function(b3,b4,b5){var b6;b6=b3.s;if(b6==null)w.Obsolete(b5);else b6!=null&&b6.$==2?(w.EnqueueSafe(b6.$1,b5),b4(b6.$0)):b6!=null&&b6.$==3?(b6.$0.push(b4),w.EnqueueSafe(b6.$1,b5)):b4(b6.$0);};w.EnqueueSafe=function(b3,b4){var b5,b6,b7,b8;b3.push(b4);if(b3.length%20===0){b5=b3.slice(0);bR.Clear(b3);for(b6=0,b7=bD.length(b5)-1;b6<=b7;b6++){b8=bD.get(b5,b6);if(typeof b8=="object")(function(b9){if(b9.s)b3.push(b9);}(b8));else(function(b9){b3.push(b9);}(b8));}}else void 0;};w.MarkDone=function(b3,b4,b5){var b6;if(b6=b4.s,b6!=null&&b6.$==0)w.MarkForever(b3,b5);else w.MarkReady(b3,b5);};w.MarkReady=function(b3,b4){var b5,b6,b7,b8;b5=b3.s;if(b5!=null&&b5.$==3){b3.s={$:2,$0:b4,$1:b5.$1};b6=b5.$0;for(b7=0,b8=bD.length(b6)-1;b7<=b8;b7++)(bD.get(b6,b7))(b4);}else void 0;};w.MarkForever=function(b3,b4){var b5,b6,b7,b8;b5=b3.s;if(b5!=null&&b5.$==3){b3.s={$:0,$0:b4};b6=b5.$0;for(b7=0,b8=bD.length(b6)-1;b7<=b8;b7++)(bD.get(b6,b7))(b4);}else void 0;};w.TryGet=function(b3){var b4,b5;b4=b3.s;return(b4!=null&&b4.$==0?(b5=b4.$0,true):b4!=null&&b4.$==2&&(b5=b4.$0,true))?{$:1,$0:b5}:null;};x=c.Var=bK.Class({},k,x);x.New=bK.Ctor(function(){k.New.call(this);},x);y=c.View=bK.Class({get_V:function(){return bQ.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bK.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(b3){var b4;b4=b3(this.Get());if(b4!=null&&b4.$==1)this.Set(b4.$0);},Update:function(b3){this.Set(b3(this.Get()));},SetFinal:function(b3){if(this.isConst)(function(b4){return b4("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b4){bM.log(b4);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=b3;this.snap=w.New({$:0,$0:b3});}},Set:function(b3){if(this.isConst)(function(b4){return b4("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b4){bM.log(b4);}));else{w.Obsolete(this.snap);this.current=b3;this.snap=w.New({$:2,$0:b3,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bK.Ctor(function(b3,b4,b5){var b6;b6=this;x.New.call(this);this.isConst=b3;this.current=b5;this.snap=b4;this.view=function(){return b6.snap;};this.id=h.Int();},z);A=c.Var$1=bK.Class({},k,A);A.MapLens=function(b3,b4,b5){return y.MapSeqCachedViewBy(b3,function(b6,b7){var b8,b9;function b_(b$){return bL.Equals(b3(b$),b6);}b8=h.Id();return b4((b9=new x({Get:function(){return bJ.find(b_,b5.Get());},Set:function(b$){function ca(cb){return b$;}return b5.Update(function(cb){return f.replaceFirst(b_,ca,cb);});},SetFinal:function(b$){return this.Set(b$);},Update:function(b$){return b5.Update(function(ca){return f.replaceFirst(b_,b$,ca);});},UpdateMaybe:function(b$){return b5.Update(function(ca){return f.maybeReplaceFirst(b_,b$,ca);});},get_View:function(){return b7;},get_Id:function(){return b8;}}),(x.New.call(b9),b9)));},b5.get_View());};A.Lens=function(b3,b4,b5){var b6,b7,b8;b6=h.Id();b7=y.Map(b4,b3.get_View());b8=new x({Get:function(){return b4(b3.Get());},Set:function(b9){return b3.Update(function(b_){return b5(b_,b9);});},SetFinal:function(b9){return this.Set(b9);},Update:function(b9){return b3.Update(function(b_){return b5(b_,b9(b4(b_)));});},UpdateMaybe:function(b9){return b3.UpdateMaybe(function(b_){var b$;b$=b9(b4(b_));return b$==null?null:{$:1,$0:b5(b_,b$.$0)};});},get_View:function(){return b7;},get_Id:function(){return b6;}});x.New.call(b8);return b8;};A.Update=function(b3,b4){A.Set(b3,b4(b3.Get()));};A.SetFinal=function(b3,b4){b3.SetFinal(b4);};A.Set=function(b3,b4){b3.Set(b4);};A.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};A.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};A.CreateLogged=function(b3,b4){var b5;if(!self.UINVars)self.UINVars=[];b5=A.Create$1(b4);self.UINVars.push([b3,b5]);return b5;};A.Create$1=function(b3){return new z.New(false,w.New({$:2,$0:b3,$1:[]}),b3);};A.New=bK.Ctor(function(){k.New.call(this);},A);B=c.Updates=bK.Class({set_Value:function(b3){var b4;b4=this.s;if(!(b4===null))w.Obsolete(b4);this.c=b3;}},null,B);B.Create=function(b3){var b4;b4=null;b4=B.New(b3,null,function(){var b5;b5=b4.s;return b5===null?(b5=w.Copy(b4.c()),b4.s=b5,w.WhenObsoleteRun(b5,function(){b4.s=null;}),b5):b5;});return b4;};B.New=function(b3,b4,b5){return new B({c:b3,s:b4,v:b5});};y.get_Do=function(){return D.B;};y.Apply=function(b3,b4){return y.Map2(function(b5,b6){return b5(b6);},b3,b4);};y.AsyncAwait=function(b3,b4){function b5(b6){var b7,b8;function b9(){return y.RemovableSink(function(b_){if(b3(b_)){(bS.Force(b7))();b6(b_);}},b4);}b7=bS.Create(b9);b8=bS.Force(b7);}return bN.FromContinuations(function(b6,b7,b8){return b5.apply(null,[b6,b7,b8]);});};y.RemovableSink=function(b3,b4){var b5;function b6(){w.WhenRun(b4(),function(b7){if(b5[0])b3(b7);},function(){if(b5[0])bN.scheduler().Fork(b6);});}b5=[true];bN.scheduler().Fork(b6);return function(){b5[0]=false;};};y.Sink=function(b3,b4){function b5(){w.WhenRun(b4(),b3,function(){bN.scheduler().Fork(b5);});}bN.scheduler().Fork(b5);};y.TryFinally=function(b3,b4){return y.CreateLazy(function(){try{return b4();}finally{b3();}});};y.TryWith=function(b3,b4){return y.CreateLazy(function(){try{return b4();}catch(b5){return(b3(b5))();}});};y.ConstAsync=function(b3){var b4;b4=w.CreateForeverAsync(b3);return function(){return b4;};};y.Const=function(b3){var b4;b4=w.New({$:0,$0:b3});return function(){return b4;};};y.Sequence=function(b3){return y.CreateLazy(function(){return w.Sequence(bJ.map(function(b4){return b4();},b3));});};y.UpdateWhile=function(b3,b4,b5){var b6;b6=[b3];return y.BindInner(function(b7){return b7?y.Map(function(b8){b6[0]=b8;return b8;},b5):y.Const(b6[0]);},b4);};y.BindInner=function(b3,b4){return y.JoinInner(y.Map(b3,b4));};y.JoinInner=function(b3){return y.CreateLazy(function(){return w.JoinInner(b3());});};y.Bind=function(b3,b4){return y.Join(y.Map(b3,b4));};y.Join=function(b3){return y.CreateLazy(function(){return w.Join(b3());});};y.MapSeqCachedView=function(b3,b4){function b5(b6){return b3;}return y.MapSeqCachedViewBy(a.id,function(b6,b7){return(b5(b6))(b7);},b4);};y.MapSeqCachedViewBy=function(b3,b4,b5){var b6;b6=[new bT.New$5()];return y.Map(function(b7){var b8,b9,b_;b8=b6[0];b9=new bT.New$5();b_=d.mapInPlace(function(b$){var ca,cb,cc;ca=b3(b$);cb=b8.ContainsKey(ca)?(cc=b8.Item(ca),(A.Set(cc.r,b$),cc)):y.ConvertSeqNode(function(cd){return b4(ca,cd);},b$);b9.set_Item(ca,cb);return cb.e;},bD.ofSeq(b7));b6[0]=b9;return b_;},b5);};y.ConvertSeqNode=function(b3,b4){var b5,b6;b5=A.Create$1(b4);b6=b5.get_View();return{e:b3(b6),r:b5,w:b6};};y.MapSeqCached=function(b3,b4){return y.MapSeqCachedBy(a.id,b3,b4);};y.MapSeqCachedBy=function(b3,b4,b5){var b6;b6=[new bT.New$5()];return y.Map(function(b7){var b8,b9,b_;b8=b6[0];b9=new bT.New$5();b_=d.mapInPlace(function(b$){var ca,cb;ca=b3(b$);cb=b8.ContainsKey(ca)?b8.Item(ca):b4(b$);b9.set_Item(ca,cb);return cb;},bD.ofSeq(b7));b6[0]=b9;return b_;},b5);};y.SnapshotOn=function(b3,b4,b5){var b6;b6=w.New({$:2,$0:b3,$1:[]});return y.CreateLazy(function(){return b6.s==null?w.SnapshotOn(b4(),b5()):(w.WhenObsolete(b4(),b6),b6);});};y.GetAsync=function(b3){return bN.FromContinuations(function(b4){return y.Get(b4,b3);});};y.WithInitOption=function(b3){return y.CreateLazy(function(){return w.WithInitOption(b3());});};y.WithInit=function(b3,b4){return y.CreateLazy(function(){return w.WithInit(b3,b4());});};y.Get=function(b3,b4){var b5;function b6(){w.WhenRun(b4(),function(b7){if(!b5[0]){b5[0]=true;b3(b7);}},function(){if(!b5[0])b6();});}b5=[false];b6();};y.TryGet=function(b3){return w.TryGet(b3());};y.MapAsync2=function(b3,b4,b5){return y.MapAsync(a.id,y.Map2(b3,b4,b5));};y.MapAsync=function(b3,b4){return y.CreateLazy(function(){return w.MapAsync(b3,b4());});};y.Map3=function(b3,b4,b5,b6){return y.CreateLazy(function(){return w.Map3(b3,b4(),b5(),b6());});};y.Map2Unit=function(b3,b4){return y.CreateLazy(function(){return w.Map2Unit(b3(),b4());});};y.Map2=function(b3,b4,b5){return y.CreateLazy(function(){return w.Map2(b3,b4(),b5());});};y.MapCached=function(b3,b4){return y.MapCachedBy(bL.Equals,b3,b4);};y.MapCachedBy=function(b3,b4,b5){var b6;b6=[null];return y.CreateLazy(function(){return w.MapCachedBy(b3,b6,b4,b5());});};y.Map=function(b3,b4){return y.CreateLazy(function(){return w.Map(b3,b4());});};y.CreateLazy=function(b3){var b4;b4={c:null,o:b3};return function(){var b5,b6;b5=b4.c;return b5===null?(b5=b4.o(),b4.c=b5,(b6=b5.s,b6!=null&&b6.$==0)?b4.o=null:w.WhenObsoleteRun(b5,function(){b4.c=null;}),b5):b5;};};C=c.FromView=bK.Class({get_Id:function(){return"uinref"+a.String(this.id);},SetFinal:function(b3){this.set(b3);},Update:function(b3){var b4;y.Get((b4=this.set,function(b5){return b4(b3(b5));}),this.view);},UpdateMaybe:function(b3){var b4;b4=this;y.Get(function(b5){var b6;b6=b3(b5);if(b6!=null&&b6.$==1)b4.set(b6.$0);},this.view);},Set:function(b3){this.set(b3);},Get:function(){return this.current;},get_View:function(){return this.view;}},x,C);C.New=bK.Ctor(function(b3,b4){var b5,b6;b5=this;x.New.call(this);this.set=b4;this.id=h.Int();this.current=(b6=y.TryGet(b3),b6==null?null:b6.$0);this.view=y.Map(function(b7){b5.current=b7;return b7;},b3);},C);D.B={$:0};E=c.Submitter=bK.Class({Trigger:function(){this["var"].Set(null);}},k,E);E.New=bK.Ctor(function(b3,b4){k.New.call(this);this.input=b3;this["var"]=A.Create();this.view=y.SnapshotOn(b4,this["var"].get_View(),this.input);},E);E.CreateOption=function(b3){return new E.New(y.Map(function(b4){return{$:1,$0:b4};},b3),null);};F.Fresh=function(){return{$:0,$0:h.Int()};};G=c.Model=bK.Class({},k,G);G.New=bK.Ctor(function(b3,b4){var b5;b5=A.Create$1(b4);G.New$1.call(this,b5,y.Map(b3,b5.get_View()));},G);G.New$1=bK.Ctor(function(b3,b4){k.New.call(this);this["var"]=b3;this.view=b4;},G);G.Update=function(b3,b4){A.Update(b4["var"],function(b5){b3(b5);return b5;});};G.Create=function(b3,b4){return new G.New(b3,b4);};H.Default=function(){N.$cctor();return N.Default;};J=I.ArrayStorage=bK.Class({SSet:function(b3){return bD.ofSeq(b3);},SSetAt:function(b3,b4,b5){bD.set(b5,b3,b4);return b5;},SRemoveIf:function(b3,b4){return bD.filter(function(b5){return!b3(b5);},b4);},SInit:function(){return this.init;},SPrependMany:function(b3,b4){var b5;b5=d.ofSeqNonCopying(b3);b4.unshift.apply(b4,b5);return b4;},SPrepend:function(b3,b4){b4.unshift(b3);return b4;},SAppendMany:function(b3,b4){var b5;b5=d.ofSeqNonCopying(b3);b4.push.apply(b4,b5);return b4;},SAppend:function(b3,b4){b4.push(b3);return b4;}},k,J);J.New=bK.Ctor(function(b3){k.New.call(this);this.init=b3;},J);K=I.LocalStorageBackend=bK.Class({clear:function(){this.storage.removeItem(this.id);},set:function(b3){this.storage.setItem(this.id,bU.stringify(bD.map(this.serializer.Encode,b3)));return b3;},SSet:function(b3){return this.set(bD.ofSeq(b3));},SSetAt:function(b3,b4,b5){bD.set(b5,b3,b4);return this.set(b5);},SRemoveIf:function(b3,b4){return this.set(bD.filter(function(b5){return!b3(b5);},b4));},SInit:function(){var b3;b3=this.storage.getItem(this.id);if(b3===null)return[];else try{return bD.map(this.serializer.Decode,bU.parse(b3));}catch(b4){return[];}},SPrependMany:function(b3,b4){var b5;b5=d.ofSeqNonCopying(b3);b4.unshift.apply(b4,b5);return this.set(b4);},SPrepend:function(b3,b4){b4.unshift(b3);return this.set(b4);},SAppendMany:function(b3,b4){var b5;b5=d.ofSeqNonCopying(b3);b4.push.apply(b4,b5);return this.set(b4);},SAppend:function(b3,b4){b4.push(b3);return this.set(b4);}},k,K);K.New=bK.Ctor(function(b3,b4){k.New.call(this);this.id=b3;this.serializer=b4;this.storage=self.localStorage;},K);I.LocalStorage=function(b3,b4){return new K.New(b3,b4);};I.InMemory=function(b3){return new J.New(b3);};L=c.ListModel=bK.Class({Wrap:function(b3,b4,b5){return L.Wrap(this,b3,b4,b5);},MapLens:function(b3){var b4;b4=this;return y.MapSeqCachedViewBy(b4.key,function(b5,b6){return b3(b5,b4["LensInto'"](a.id,function(b7,b8){return b8;},b5,b6));},this["var"].get_View());},Lens:function(b3){return this.LensInto(a.id,function(b4,b5){return b5;},b3);},LensInto:function(b3,b4,b5){return this["LensInto'"](b3,b4,b5,y.Map(b3,this.FindByKeyAsView(b5)));},"LensInto'":function(b3,b4,b5,b6){var b7,b8,b9;b7=this;b8=h.Id();b9=new x({Get:function(){return b3(b7.FindByKey(b5));},Set:function(b_){return b7.UpdateBy(function(b$){return{$:1,$0:b4(b$,b_)};},b5);},SetFinal:function(b_){return this.Set(b_);},Update:function(b_){return b7.UpdateBy(function(b$){return{$:1,$0:b4(b$,b_(b3(b$)))};},b5);},UpdateMaybe:function(b_){return b7.UpdateBy(function(b$){var ca;ca=b_(b3(b$));return ca==null?null:{$:1,$0:b4(b$,ca.$0)};},b5);},get_View:function(){return b6;},get_Id:function(){return b8;}});x.New.call(b9);return b9;},get_LengthAsView:function(){return y.Map(bD.length,this["var"].get_View());},get_Length:function(){return bD.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(b3,b4){var b5,b6,b7,b8,b9;b5=this;b6=this["var"].Get();b7=bD.tryFindIndex(function(b_){return bL.Equals(b5.key(b_),b4);},b6);if(b7!=null&&b7.$==1){b8=b7.$0;b9=b3(bD.get(b6,b8));b9!=null&&b9.$==1?(this["var"].Set(this.storage.SSetAt(b8,b9.$0,b6)),this.ObsoleteKey(b4)):void 0;}},UpdateAll:function(b3){var b4;b4=this;this["var"].Update(function(b5){bD.iteri(function(b6,b7){var b8;b8=b3(b7);return b8==null?null:bD.set(b5,b6,b8.$0);},b5);return b4.storage.SSet(b5);});this.ObsoleteAll();},FindByKeyAsView:function(b3){return y.Map(function(b4){return b4.$0;},this.TryFindByKeyAsView(b3));},TryFindByKeyAsView:function(b3){var b4;b4=this;return function(){var b5,b6,b7;b5=(b6=null,[b4.it.TryGetValue(b3,{get:function(){return b6;},set:function(b8){b6=b8;}}),b6]);return b5[0]?b5[1]:(b7=w.New({$:2,$0:b4.TryFindByKey(b3),$1:[]}),(b4.it.DAdd(b3,b7),b7));};},TryFindByKey:function(b3){var b4;b4=this;return bD.tryFind(function(b5){return bL.Equals(b4.key(b5),b3);},this["var"].Get());},FindByKey:function(b3){var b4;b4=this;return bD.find(function(b5){return bL.Equals(b4.key(b5),b3);},this["var"].Get());},TryFindAsView:function(b3){return y.Map(function(b4){return bD.tryFind(b3,b4);},this["var"].get_View());},FindAsView:function(b3){return y.Map(function(b4){return bD.find(b3,b4);},this["var"].get_View());},TryFind:function(b3){return bD.tryFind(b3,this["var"].Get());},Find:function(b3){return bD.find(b3,this["var"].Get());},ContainsKeyAsView:function(b3){var b4;function b5(b6){return bL.Equals(b4.key(b6),b3);}b4=this;return y.Map(function(b6){return bD.exists(b5,b6);},this["var"].get_View());},ContainsKey:function(b3){var b4;b4=this;return bD.exists(function(b5){return bL.Equals(b4.key(b5),b3);},this["var"].Get());},Set:function(b3){this["var"].Set(this.storage.SSet(b3));this.ObsoleteAll();},Iter:function(b3){bD.iter(b3,this["var"].Get());},RemoveByKey:function(b3){var b4;b4=this;this["var"].Set(this.storage.SRemoveIf(function(b5){return bL.Equals(b4.key(b5),b3);},this["var"].Get()));this.ObsoleteKey(b3);},RemoveBy:function(b3){var b4,b5,b6,b7;b4=this["var"].Get();for(b5=0,b6=b4.length-1;b5<=b6;b5++){b7=bD.get(b4,b5);if(b3(b7))this.ObsoleteKey(this.key(b7));}this["var"].Set(this.storage.SRemoveIf(b3,this["var"].Get()));},Remove:function(b3){var b4,b5,b6,b7;b4=this;b5=this["var"].Get();if(M.Contains(b4.key,b3,b5)){b6=b4.key;b7=b6(b3);this["var"].Set(this.storage.SRemoveIf(function(b8){return bL.Equals(b6(b8),b7);},b5));this.ObsoleteKey(b7);}},PrependMany:function(b3){var b4,b5;function b6(b7,b8){var b9,b_;b9=b4.key(b8);b4.ObsoleteKey(b9);b_=bD.tryFindIndex(function(b$){return bL.Equals(b4.key(b$),b9);},b7);return b_==null?(b5.push(b8),b7):b4.storage.SSetAt(b_.$0,b8,b7);}b4=this;b5=bK.MarkResizable([]);this["var"].Set(this.storage.SPrependMany(b5,(((bK.Curried3(bJ.fold))(b6))(this["var"].Get()))(b3)));},Prepend:function(b3){var b4,b5,b6,b7;b4=this;b5=this["var"].Get();b6=this.key(b3);b7=bD.tryFindIndex(function(b8){return bL.Equals(b4.key(b8),b6);},b5);if(b7!=null&&b7.$==1)this["var"].Set(this.storage.SSetAt(b7.$0,b3,b5));else this["var"].Set(this.storage.SPrepend(b3,b5));this.ObsoleteKey(b6);},AppendMany:function(b3){var b4,b5;function b6(b7,b8){var b9,b_;b9=b4.key(b8);b4.ObsoleteKey(b9);b_=bD.tryFindIndex(function(b$){return bL.Equals(b4.key(b$),b9);},b7);return b_==null?(b5.push(b8),b7):b4.storage.SSetAt(b_.$0,b8,b7);}b4=this;b5=bK.MarkResizable([]);this["var"].Set(this.storage.SAppendMany(b5,(((bK.Curried3(bJ.fold))(b6))(this["var"].Get()))(b3)));},Append:function(b3){var b4,b5,b6,b7;b4=this;b5=this["var"].Get();b6=this.key(b3);b7=bD.tryFindIndex(function(b8){return bL.Equals(b4.key(b8),b6);},b5);if(b7!=null&&b7.$==1)this["var"].Set(this.storage.SSetAt(b7.$0,b3,b5));else this["var"].Set(this.storage.SAppend(b3,b5));this.ObsoleteKey(b6);},ObsoleteAll:function(){bJ.iter(function(b3){w.Obsolete(b3.V);},this.it);this.it.Clear();},ObsoleteKey:function(b3){var b4,b5;b4=(b5=null,[this.it.TryGetValue(b3,{get:function(){return b5;},set:function(b6){b5=b6;}}),b5]);if(b4[0]){w.Obsolete(b4[1]);this.it.RemoveKey(b3);}},GetEnumerator0:function(){return bE.Get0(this["var"].Get());},GetEnumerator:function(){return bE.Get(this["var"].Get());}},k,L);L.New=bK.Ctor(function(b3,b4){L.New$3.call(this,b3,A.Create$1(bD.ofSeq(bJ.distinctBy(b3,b4.SInit()))),b4);},L);L.New$1=bK.Ctor(function(b3){L.New$2.call(this,b3,[]);},L);L.New$2=bK.Ctor(function(b3,b4){var b5;b5=bD.ofSeq(b4);L.New$3.call(this,b3,A.Create$1(b5),I.InMemory(b5));},L);L.New$3=bK.Ctor(function(b3,b4,b5){k.New.call(this);this.key=b3;this["var"]=b4;this.storage=b5;this.v=y.Map(function(b6){return b6.slice();},this["var"].get_View());this.it=new bT.New$5();},L);M.Contains=function(b3,b4,b5){var b6;b6=b3(b4);return bD.exists(function(b7){return bL.Equals(b3(b7),b6);},b5);};L.Wrap=function(b3,b4,b5,b6){var b7,b8;b7=[new bT.New$5()];b8=bD.map(function(b9){var b_;b_=b5(b9);b7[0].set_Item(b3.key(b9),b_);return b_;},b3["var"].Get());return new L.New$3(function(b9){return b3.key(b4(b9));},A.Lens(b3["var"],function(b9){var b_,b$;b_=new bT.New$5();b$=bD.map(function(ca){var cb,cc;cb=b3.key(ca);cc=b7[0].ContainsKey(cb)?b6(b7[0].Item(cb),ca):b5(ca);b_.set_Item(cb,cc);return cc;},b9);b7[0]=b_;return b$;},function(b9,b_){var b$,ca;b$=new bT.New$5();ca=bD.map(function(cb){var cc;cc=b4(cb);b$.set_Item(b3.key(cc),cb);return cc;},b_);b7[0]=b$;return ca;}),I.InMemory(b8));};L.FromSeq=function(b3){return L.Create(a.id,b3);};L.Create=function(b3,b4){return L.CreateWithStorage(b3,I.InMemory(bD.ofSeq(b4)));};L.CreateWithStorage=function(b3,b4){return new L.New(b3,b4);};N.$cctor=function(){N.$cctor=a.ignore;N.Default={Encode:a.id,Decode:a.id};};O=c.ReactiveExtensions=bK.Class({},k,O);O.New=bK.Ctor(function(){k.New.call(this);},O);P=c.DoubleInterpolation=bK.Class({Interpolate:function(b3,b4,b5){return b4+b3*(b5-b4);}},null,P);P.DoubleInterpolation=new P({$:0});Q.get_Double=function(){return P.DoubleInterpolation;};R=c.Easing=bK.Class({TransformTime:function(b3){return this.transformTime(b3);}},k,R);R.get_CubicInOut=function(){return S.CubicInOut();};R.Custom=function(b3){return new R.New(b3);};R.New=bK.Ctor(function(b3){k.New.call(this);this.transformTime=b3;},R);S.CubicInOut=function(){W.$cctor();return W.CubicInOut;};T.get_Empty=function(){return{$:0,$0:p.Empty()};};T.WhenDone=function(b3,b4){return T.Append({$:0,$0:p.Single({$:0,$0:b3})},b4);};T.Run=function(b3,b4){var b5;function b6(b7){function b8(b9){return function(b_){var b$;b$=b_-b9;b4.Compute(b$);b3();return b$<=b5?void a.requestAnimationFrame(function(ca){(b8(b9))(ca);}):b7();};}a.requestAnimationFrame(function(b9){(b8(b9))(b9);});}b5=b4.Duration;return b5===0?bN.Zero():bN.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);});};T.Play=function(b3){var b4;b4=null;return bN.Delay(function(){return bN.Bind(T.Run(a.ignore,U.Actions(b3)),function(){U.Finalize(b3);return bN.Return(null);});});};T.Pack=function(b3){return{$:0,$0:p.Single({$:1,$0:b3})};};T.Map=function(b3,b4){var b5;return U.Def(b4.Duration,(b5=b4.Compute,function(b6){return b3(b5(b6));}));};T.Delayed=function(b3,b4,b5,b6,b7,b8){return{Compute:function(b9){return b9<=b6?b7:b3.Interpolate(b4.TransformTime((b9-b6)/b5),b7,b8);},Duration:b5+b6};};T.Simple=function(b3,b4,b5,b6,b7){return{Compute:function(b8){return b3.Interpolate(b4.TransformTime(b8/b5),b6,b7);},Duration:b5};};T.Const=function(b3){return U.Const(b3);};T.Concat=function(b3){return{$:0,$0:p.Concat(bJ.map(U.List,b3))};};T.Append=function(b3,b4){return{$:0,$0:p.Append(b3.$0,b4.$0)};};T.set_UseAnimations=function(b3){U.set_UseAnimations(b3);};T.get_UseAnimations=function(){return U.UseAnimations();};U.UseAnimations=function(){W.$cctor();return W.UseAnimations;};U.set_UseAnimations=function(b3){W.$cctor();W.UseAnimations=b3;};U.Actions=function(b3){return U.ConcatActions(bD.choose(function(b4){return b4.$==1?{$:1,$0:b4.$0}:null;},p.ToArray(b3.$0)));};U.ConcatActions=function(b3){var b4,b5,b6,b7;b4=d.ofSeqNonCopying(b3);b5=bD.length(b4);return b5===0?U.Const():b5===1?bD.get(b4,0):(b6=bJ.max(bJ.map(function(b8){return b8.Duration;},b4)),(b7=bD.map(function(b8){return U.Prolong(b6,b8);},b4),U.Def(b6,function(b8){bD.iter(function(b9){b9.Compute(b8);},b7);})));};U.Prolong=function(b3,b4){var b5,b6,b7;b5=b4.Compute;b6=b4.Duration;b7=bS.Create(function(){return b4.Compute(b4.Duration);});return{Compute:function(b8){return b8>=b6?b7.f():b5(b8);},Duration:b3};};U.Const=function(b3){return U.Def(0,function(){return b3;});};U.Def=function(b3,b4){return{Compute:b4,Duration:b3};};U.Finalize=function(b3){bD.iter(function(b4){if(b4.$==0)b4.$0();},p.ToArray(b3.$0));};U.List=function(b3){return b3.$0;};V=c.Trans=bK.Class({Copy:function(b3,b4,b5,b6){var b7,b8,b9,b_,b$;function ca(cb,cc){return b7.TChange(cb,cc);}b7=this;b8=b3==null?function(cb){return function(cc){return ca(cb,cc);};}:b3.$0;return new V.New$3(function(cb,cc){return(b8(cb))(cc);},(b9=this.get_TEnter(),b4==null?b9:b4.$0),(b_=this.get_TExit(),b5==null?b_:b5.$0),(b$=this.get_TFlags(),b6==null?b$:b6.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(b3,b4){return this.change(b3,b4);}},k,V);V.New=bK.Ctor(function(b3,b4,b5){V.New$3.call(this,b3,bL.Equals(b4,null)?T.Const:b4,bL.Equals(b5,null)?T.Const:b5,1|(bL.Equals(b4,null)?0:2)|(bL.Equals(b5,null)?0:4));},V);V.New$1=bK.Ctor(function(b3){V.New$3.call(this,b3,T.Const,T.Const,1);},V);V.New$2=bK.Ctor(function(){V.New$3.call(this,function(b3,b4){return T.Const(b4);},T.Const,T.Const,0);},V);V.New$3=bK.Ctor(function(b3,b4,b5,b6){k.New.call(this);this.change=b3;this.enter=b4;this.exit=b5;this.flags=b6;},V);V.Exit=function(b3,b4){return b4.Copy(null,null,{$:1,$0:b3},{$:1,$0:b4.get_TFlags()|4});};V.Enter=function(b3,b4){return b4.Copy(null,{$:1,$0:b3},null,{$:1,$0:b4.get_TFlags()|2});};V.Change=function(b3,b4){return b4.Copy({$:1,$0:b3},null,null,{$:1,$0:b4.get_TFlags()|1});};V.Create=function(b3){return new V.New$1(b3);};V.Trivial=function(){return new V.New$2();};V.CanAnimateExit=function(b3){var b4,b5;b4=b3.get_TFlags();b5=4;return(b4&b5)===b5;};V.CanAnimateEnter=function(b3){var b4,b5;b4=b3.get_TFlags();b5=2;return(b4&b5)===b5;};V.CanAnimateChange=function(b3){var b4,b5;b4=b3.get_TFlags();b5=1;return(b4&b5)===b5;};V.AnimateExit=function(b3,b4){return(b3.get_TExit())(b4);};V.AnimateEnter=function(b3,b4){return(b3.get_TEnter())(b4);};V.AnimateChange=function(b3,b4,b5){return b3.TChange(b4,b5);};W.$cctor=function(){W.$cctor=a.ignore;W.CubicInOut=R.Custom(function(b3){var b4;b4=b3*b3;return 3*b4-2*(b4*b3);});W.UseAnimations=true;};Z=c.OnAfterRenderControl=bK.Class({get_Body:function(){var b3,b4,b5,b6,b7,b8;b4=self.document.querySelectorAll("[ws-runafterrender]");for(b5=0,b6=b4.length-1;b5<=b6;b5++){b7=b4[b5];b8=a["eval"](b7.getAttribute("ws-runafterrender"));b7.removeAttribute("ws-runafterrender");b8(b7);}b3={ReplaceInDom:function(){return null;}};k.New.call(b3);return b3;}},Y,Z);_0=c.AnimatedAttrNode=bK.Class({sync:function(b3){var b4;if(this.dirty){b4=this.logical;if(b4==null);else(this.push(b3))(b4.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(b3,b4){this.visible={$:1,$0:b4};this.dirty=true;(this.push(b3))(b4);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(b3){var b4,b5;b4=this;return T.WhenDone(function(){b4.dirty=true;b4.visible=null;},(b5=this.visible,b5!=null&&b5.$==1?T.Pack(T.Map(function(b6){b4.pushVisible(b3,b6);},V.AnimateExit(this.tr,b5.$0))):T.get_Empty()));},NGetEnterAnim:function(b3){var b4,b5,b6,b7,b8;b4=this;return T.WhenDone(function(){b4.sync(b3);},(b5=this.visible,(b6=this.logical,b5!=null&&b5.$==1&&(b6!=null&&b6.$==1&&(this.dirty&&(b7=[b6.$0,b5.$0],true)))?T.Pack(T.Map(function(b9){b4.pushVisible(b3,b9);},V.AnimateChange(this.tr,b7[1],b7[0]))):b5==null&&(b6!=null&&b6.$==1)?T.Pack(T.Map(function(b9){b4.pushVisible(b3,b9);},V.AnimateEnter(this.tr,b6.$0))):T.get_Empty())));},NGetChangeAnim:function(b3){var b4,b5,b6,b7;b4=this;return T.WhenDone(function(){b4.sync(b3);},(b5=this.visible,(b6=this.logical,b5!=null&&b5.$==1&&(b6!=null&&b6.$==1&&(this.dirty&&(b7=[b6.$0,b5.$0],true)))?T.Pack(T.Map(function(b8){b4.pushVisible(b3,b8);},V.AnimateChange(this.tr,b7[1],b7[0]))):T.get_Empty())));}},k,_0);_0.New=bK.Ctor(function(b3,b4,b5){var b6;b6=this;k.New.call(this);this.tr=b3;this.push=b5;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(b7){b6.logical={$:1,$0:b7};b6.dirty=true;},b4);},_0);_1=c.DynamicAttrNode=bK.Class({NChanged:function(){return this.updates;},NSync:function(b3){if(this.dirty){(this.push(b3))(this.value);this.dirty=false;}},NGetExitAnim:function(b3){return T.get_Empty();},NGetEnterAnim:function(b3){return T.get_Empty();},NGetChangeAnim:function(b3){return T.get_Empty();}},k,_1);_1.New=bK.Ctor(function(b3,b4){var b5;b5=this;k.New.call(this);this.push=b4;this.value=void 0;this.dirty=false;this.updates=y.Map(function(b6){b5.value=b6;b5.dirty=true;},b3);},_1);_2=c.AttrProxy=bK.Class({},null,_2);_2.Handler=function(b3,b4){return _2.HandlerImpl(b3,b4);};_2.HandlerImpl=function(b3,b4){return _6.Static(function(b5){b5.addEventListener(b3,function(b6){return(b4(b5))(b6);},false);});};_2.OnAfterRenderImpl=function(b3){return new _2({$:4,$0:b3});};_2.Concat=function(b3){var b4;b4=d.ofSeqNonCopying(b3);return d.TreeReduce(_6.EmptyAttr(),_2.Append,b4);};_2.Append=function(b3,b4){return _6.AppendTree(b3,b4);};_2.Create=function(b3,b4){return _6.Static(function(b5){b5.setAttribute(b3,b4);});};_5.New=function(b3,b4,b5,b6){var b7;b7={DynElem:b3,DynFlags:b4,DynNodes:b5};bK.SetOptional(b7,"OnAfterRender",b6);return b7;};_6.Static=function(b3){return new _2({$:3,$0:b3});};_6.Dynamic=function(b3,b4){return new _2({$:1,$0:new _1.New(b3,b4)});};_6.Animated=function(b3,b4,b5){var b6,b7,b8;b6=new _0.New(b3,b4,b5);b7=4;if(V.CanAnimateEnter(b3))b7=b7|1;if(V.CanAnimateExit(b3))b7=b7|2;b8=new _2({$:1,$0:b6});_6.SetFlags(b8,b7);return b8;};_6.EmptyAttr=function(){_.$cctor();return _.EmptyAttr;};_6.AppendTree=function(b3,b4){var b5;return b3===null?b4:b4===null?b3:(b5=new _2({$:2,$0:b3,$1:b4}),(_6.SetFlags(b5,_6.Flags(b3)|_6.Flags(b4)),b5));};_6.GetChangeAnim=function(b3){return _6.GetAnim(b3,function(b4,b5){return b4.NGetChangeAnim(b5);});};_6.GetExitAnim=function(b3){return _6.GetAnim(b3,function(b4,b5){return b4.NGetExitAnim(b5);});};_6.GetEnterAnim=function(b3){return _6.GetAnim(b3,function(b4,b5){return b4.NGetEnterAnim(b5);});};_6.GetAnim=function(b3,b4){return T.Concat(bD.map(function(b5){return b4(b5,b3.DynElem);},b3.DynNodes));};_6.Updates=function(b3){return d.MapTreeReduce(function(b4){return b4.NChanged();},y.Const(),y.Map2Unit,b3.DynNodes);};_6.Empty=function(b3){return _5.New(b3,0,[],null);};_6.Insert=function(b3,b4){var b5,b6,b7;function b8(b9){var b_,b$;while(true)if(!(b9===null)){if(b9!=null&&b9.$==1)return b5.push(b9.$0);else if(b9!=null&&b9.$==2){b_=b9.$1;b$=b9.$0;b8(b$);b9=b_;}else return b9!=null&&b9.$==3?b9.$0(b3):b9!=null&&b9.$==4?b6.push(b9.$0):null;}else return null;}b5=[];b6=[];b8(b4);b7=b5.slice(0);return _5.New(b3,_6.Flags(b4),b7,b6.length===0?null:{$:1,$0:function(b9){bJ.iter(function(b_){b_(b9);},b6);}});};_6.Sync=function(b3,b4){bD.iter(function(b5){b5.NSync(b3);},b4.DynNodes);};_6.SetFlags=function(b3,b4){b3.flags=b4;};_6.Flags=function(b3){return b3!==null&&b3.hasOwnProperty("flags")?b3.flags:0;};_6.HasExitAnim=function(b3){var b4;b4=2;return(b3.DynFlags&b4)===b4;};_6.HasEnterAnim=function(b3){var b4;b4=1;return(b3.DynFlags&b4)===b4;};_6.HasChangeAnim=function(b3){var b4;b4=4;return(b3.DynFlags&b4)===b4;};_7=c.CheckedInput=bK.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_7.Make=function(b3){var b4;return new _7({$:0,$0:b3,$1:(b4=b3,a.String(b4))});};_8.FloatApplyChecked=function(){_.$cctor();return _.FloatApplyChecked;};_8.FloatGetChecked=function(){_.$cctor();return _.FloatGetChecked;};_8.FloatSetChecked=function(){_.$cctor();return _.FloatSetChecked;};_8.FloatApplyUnchecked=function(){_.$cctor();return _.FloatApplyUnchecked;};_8.FloatGetUnchecked=function(){_.$cctor();return _.FloatGetUnchecked;};_8.FloatSetUnchecked=function(){_.$cctor();return _.FloatSetUnchecked;};_8.IntApplyChecked=function(){_.$cctor();return _.IntApplyChecked;};_8.IntGetChecked=function(){_.$cctor();return _.IntGetChecked;};_8.IntSetChecked=function(){_.$cctor();return _.IntSetChecked;};_8.IntApplyUnchecked=function(){_.$cctor();return _.IntApplyUnchecked;};_8.IntGetUnchecked=function(){_.$cctor();return _.IntGetUnchecked;};_8.IntSetUnchecked=function(){_.$cctor();return _.IntSetUnchecked;};_8.StringApply=function(){_.$cctor();return _.StringApply;};_8.StringGet=function(){_.$cctor();return _.StringGet;};_8.StringSet=function(){_.$cctor();return _.StringSet;};_8.BoolCheckedApply=function(){_.$cctor();return _.BoolCheckedApply;};_8.ApplyValue=function(b3,b4,b5){var b6;function b7(b8,b9){return b9==null?null:b8(b9.$0);}b6=null;return[function(b8){function b9(){b5.UpdateMaybe(function(b_){var b$;b6=b3(b8);return b6!=null&&b6.$==1&&(!bL.Equals(b6.$0,b_)&&(b$=[b6,b6.$0],true))?b$[0]:null;});}b8.addEventListener("change",b9);b8.addEventListener("input",b9);b8.addEventListener("keypress",b9);},function(b8){var b9;b9=b4(b8);return function(b_){return b7(b9,b_);};},y.Map(function(b8){var b9;return b6!=null&&b6.$==1&&(bL.Equals(b6.$0,b8)&&(b9=b6.$0,true))?null:{$:1,$0:b8};},b5.get_View())];};_9.ValidateForm=function(){return _9.OnAfterRender(function(b3){if(self.H5F)self.H5F.setup(b3);});};_9.Checked=function(b3){return _9.ValueWith(_8.BoolCheckedApply(),b3);};_9.FloatValue=function(b3){return _9.ValueWith(_8.FloatApplyChecked(),b3);};_9.FloatValueUnchecked=function(b3){return _9.ValueWith(_8.FloatApplyUnchecked(),b3);};_9.IntValue=function(b3){return _9.ValueWith(_8.IntApplyChecked(),b3);};_9.IntValueUnchecked=function(b3){return _9.ValueWith(_8.IntApplyUnchecked(),b3);};_9.Value=function(b3){return _9.ValueWith(_8.StringApply(),b3);};_9.ContentEditableHtml=function(b3){var b4;b4=_9.CustomVar(b3,function(b5){return function(b6){b5.innerHTML=b6;};},function(b5){return{$:1,$0:b5.innerHTML};});return _2.Append(_2.Create("contenteditable","true"),b4);};_9.ContentEditableText=function(b3){var b4;b4=_9.CustomVar(b3,function(b5){return function(b6){b5.textContent=b6;};},function(b5){return{$:1,$0:b5.textContent};});return _2.Append(_2.Create("contenteditable","true"),b4);};_9.CustomValue=function(b3,b4,b5){return _9.CustomVar(b3,function(b6){return function(b7){b6.value=b4(b7);};},function(b6){return b5(b6.value);});};_9.CustomVar=function(b3,b4,b5){return _9.ValueWith(function(b6){return _8.ApplyValue(b5,b4,b6);},b3);};_9.ValueWith=function(b3,b4){var b5;b5=b3(b4);return _2.Append(_6.Static(b5[0]),_9.DynamicCustom(b5[1],b5[2]));};_9.DynamicProp=function(b3,b4){return _6.Dynamic(b4,function(b5){return function(b6){b5[b3]=b6;};});};_9.Prop=function(b3,b4){return _6.Static(function(b5){b5[b3]=b4;});};_9.DynamicBool=function(b3,b4){function b5(b6,b7){return b7?b6.setAttribute(b3,""):b6.removeAttribute(b3);}return _6.Dynamic(b4,function(b6){return function(b7){return b5(b6,b7);};});};_9.DynamicPred=function(b3,b4,b5){function b6(b7,b8){return b8[0]?b7.setAttribute(b3,b8[1]):b7.removeAttribute(b3);}return _6.Dynamic(y.Map2(function(b7,b8){return[b7,b8];},b4,b5),function(b7){return function(b8){return b6(b7,b8);};});};_9.DynamicClass=function(b3,b4,b5){return _9.DynamicClassPred(b3,y.Map(b5,b4));};_9.Class=function(b3){return _9.ClassPred(b3,true);};_9.ClassPred=function(b3,b4){return _6.Static(function(b5){if(b4)r.AddClass(b5,b3);else r.RemoveClass(b5,b3);});};_9.DynamicClassPred=function(b3,b4){return _6.Dynamic(b4,function(b5){return function(b6){return b6?r.AddClass(b5,b3):r.RemoveClass(b5,b3);};});};_9.OnAfterRenderView=function(b3,b4){var b5;b5=h.Id();return _2.Append(_9.OnAfterRender(function(b6){b4(b6,b6[b5]);}),_9.DynamicCustom(function(b6){return function(b7){b6[b5]=b7;};},b3));};_9.OnAfterRender=function(b3){return new _2({$:4,$0:b3});};_9.HandlerView=function(b3,b4,b5){return _6.Static(function(b6){var b7;b7=b5(b6);b6.addEventListener(b3,function(b8){return y.Get(b7(b8),b4);},false);});};_9.Handler=function(b3,b4){return _6.Static(function(b5){b5.addEventListener(b3,function(b6){return(b4(b5))(b6);},false);});};_9.DynamicStyle=function(b3,b4){return _6.Dynamic(b4,function(b5){return function(b6){return b5.style.setProperty(b3,b6);};});};_9.DynamicCustom=function(b3,b4){return _6.Dynamic(b4,b3);};_9.Dynamic=function(b3,b4){return _6.Dynamic(b4,function(b5){return function(b6){return b5.setAttribute(b3,b6);};});};_9.AnimatedStyle=function(b3,b4,b5,b6){return _6.Animated(b4,b5,function(b7){return function(b8){var b9;b9=b6(b8);return b7.style.setProperty(b3,b9);};});};_9.Animated=function(b3,b4,b5,b6){return _6.Animated(b4,b5,function(b7){return function(b8){return b7.setAttribute(b3,b6(b8));};});};_9.Style=function(b3,b4){return _6.Static(function(b5){b5.style.setProperty(b3,b4);});};_.$cctor=function(){var b3,b4,b5,b6,b7,b8,b9,b_,b$,ca;_.$cctor=a.ignore;_.EmptyAttr=null;_.BoolCheckedApply=function(cb){function cc(cd,ce){return ce!=null&&ce.$==1?void(cd.checked=ce.$0):null;}return[function(cd){cd.addEventListener("change",function(){return!bL.Equals(cb.Get(),cd.checked)?cb.Set(cd.checked):null;});},function(cd){return function(ce){return cc(cd,ce);};},y.Map(function(cd){return{$:1,$0:cd};},cb.get_View())];};_.StringSet=function(cb){return function(cc){cb.value=cc;};};_.StringGet=function(cb){return{$:1,$0:cb.value};};_.StringApply=(b3=_8.StringGet(),(b4=_8.StringSet(),function(cb){return _8.ApplyValue(b3,b4,cb);}));_.IntSetUnchecked=function(cb){return function(cc){cb.value=a.String(cc);};};_.IntGetUnchecked=function(cb){var cc,cd;cc=cb.value;return e.isBlank(cc)?{$:1,$0:0}:(cd=+cc,cd!==cd>>0?null:{$:1,$0:cd});};_.IntApplyUnchecked=(b5=_8.IntGetUnchecked(),(b6=_8.IntSetUnchecked(),function(cb){return _8.ApplyValue(b5,b6,cb);}));_.IntSetChecked=function(cb){return function(cc){var cd;cd=cc.get_Input();return cb.value!==cd?void(cb.value=cd):null;};};_.IntGetChecked=function(cb){var cc,cd,ce;cc=cb.value;return{$:1,$0:e.isBlank(cc)?(cb.checkValidity?cb.checkValidity():true)?new _7({$:2,$0:cc}):new _7({$:1,$0:cc}):(cd=(ce=0,[bV.TryParseInt32(cc,{get:function(){return ce;},set:function(cf){ce=cf;}}),ce]),cd[0]?new _7({$:0,$0:cd[1],$1:cc}):new _7({$:1,$0:cc}))};};_.IntApplyChecked=(b7=_8.IntGetChecked(),(b8=_8.IntSetChecked(),function(cb){return _8.ApplyValue(b7,b8,cb);}));_.FloatSetUnchecked=function(cb){return function(cc){cb.value=a.String(cc);};};_.FloatGetUnchecked=function(cb){var cc,cd;cc=cb.value;return e.isBlank(cc)?{$:1,$0:0}:(cd=+cc,a.isNaN(cd)?null:{$:1,$0:cd});};_.FloatApplyUnchecked=(b9=_8.FloatGetUnchecked(),(b_=_8.FloatSetUnchecked(),function(cb){return _8.ApplyValue(b9,b_,cb);}));_.FloatSetChecked=function(cb){return function(cc){var cd;cd=cc.get_Input();return cb.value!==cd?void(cb.value=cd):null;};};_.FloatGetChecked=function(cb){var cc,cd;cc=cb.value;return{$:1,$0:e.isBlank(cc)?(cb.checkValidity?cb.checkValidity():true)?new _7({$:2,$0:cc}):new _7({$:1,$0:cc}):(cd=+cc,a.isNaN(cd)?new _7({$:1,$0:cc}):new _7({$:0,$0:cd,$1:cc}))};};_.FloatApplyChecked=(b$=_8.FloatGetChecked(),(ca=_8.FloatSetChecked(),function(cb){return _8.ApplyValue(b$,ca,cb);}));};$.BatchUpdatesEnabled=function(){bj.$cctor();return bj.BatchUpdatesEnabled;};$.set_BatchUpdatesEnabled=function(b3){bj.$cctor();bj.BatchUpdatesEnabled=b3;};ba=c.DocElemNode=bK.Class({GetHashCode:function(){return this.ElKey;},Equals:function(b3){return this.ElKey===b3.ElKey;}},null,ba);ba.New=function(b3,b4,b5,b6,b7,b8){var b9;return new ba((b9={Attr:b3,Children:b4,El:b6,ElKey:b7},(bK.SetOptional(b9,"Delimiters",b5),bK.SetOptional(b9,"Render",b8),b9)));};bc.FoldBack=function(b3,b4,b5){return bD.foldBack(b3,b4.$0,b5);};bc.Iter=function(b3,b4){bD.iter(b3,b4.$0);};bc.Except=function(b3,b4){var b5;b5=b3.$0;return{$:0,$0:bD.filter(function(b6){return bD.forall(function(b7){return!(b6===b7);},b5);},b4.$0)};};bc.DocChildren=function(b3){var b4;function b5(b6){var b7,b8,b9,b_;while(true){if(b6!=null&&b6.$==2){b8=b6.$0;b6=b8.Current;}else if(b6!=null&&b6.$==1)return b4.push(b6.$0.El);else if(b6==null)return null;else if(b6!=null&&b6.$==5)return b4.push(b6.$0);else if(b6!=null&&b6.$==4)return b4.push(b6.$0.Text);else if(b6!=null&&b6.$==6){b7=b6.$0.Els;return(function(b$){return function(ca){bD.iter(b$,ca);};}(function(b$){if(b$==null||b$.constructor===a.Object)b5(b$);else b4.push(b$);}))(b7);}else{b9=b6.$1;b_=b6.$0;b5(b_);b6=b9;}}}b4=[];b5(b3.Children);return{$:0,$0:d.ofSeqNonCopying(b4)};};bc.Children=function(b3,b4){var b5,b6,b7;if(b4!=null&&b4.$==1){b7=[];b5=b4.$0[0].nextSibling;while(b5!==b4.$0[1]){b7.push(b5);b5=b5.nextSibling;}return{$:0,$0:b7};}else return{$:0,$0:bD.init(b3.childNodes.length,(b6=b3.childNodes,function(b8){return b6[b8];}))};};bd.ToArray=function(b3){return i.ToArray(b3.$0);};bd.get_Empty=function(){return{$:0,$0:new bI.New$3()};};bd.IsEmpty=function(b3){return b3.$0.Count()===0;};bd.Intersect=function(b3,b4){return{$:0,$0:i.Intersect(b3.$0,b4.$0)};};bd.Except=function(b3,b4){return{$:0,$0:i.Except(b3.$0,b4.$0)};};bd.FindAll=function(b3){var b4;function b5(b8,b9){var b_,b$,ca,cb,cc;while(true)switch(b8){case 0:if(b9!=null&&b9.$==0){b$=b9.$1;ca=b9.$0;b5(0,ca);b9=b$;}else if(b9!=null&&b9.$==1){cb=b9.$0;b9=cb;b8=1;}else if(b9!=null&&b9.$==2){cc=b9.$0;b9=cc.Current;}else return b9!=null&&b9.$==6?(b_=b9.$0.Holes,(function(cd){return function(ce){bD.iter(cd,ce);};}(b7))(b_)):null;break;case 1:b4.push(b9);b9=b9.Children;b8=0;break;}}function b6(b8){return b5(0,b8);}function b7(b8){return b5(1,b8);}b4=[];b6(b3);return{$:0,$0:new bI.New$2(b4)};};bd.Filter=function(b3,b4){return{$:0,$0:i.Filter(b3,b4.$0)};};be.New=function(b3,b4){return{PreviousNodes:b3,Top:b4};};bf.UpdateTextNode=function(b3,b4){b3.Value=b4;b3.Dirty=true;};bf.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};bf.UpdateEmbedNode=function(b3,b4){b3.Current=b4;b3.Dirty=true;};bf.CreateEmbedNode=function(){return{Current:null,Dirty:false};};bf.PerformSyncUpdate=function(b3,b4,b5){var b6;b6=bd.FindAll(b5);bf.SyncElemNode(b3,b4.Top);b4.PreviousNodes=b6;};bf.PerformAnimatedUpdate=function(b3,b4,b5){var b6;return T.get_UseAnimations()?(b6=null,bN.Delay(function(){var b7,b8,b9;b7=bd.FindAll(b5);b8=bf.ComputeChangeAnim(b4,b7);b9=bf.ComputeEnterAnim(b4,b7);return bN.Bind(T.Play(T.Append(b8,bf.ComputeExitAnim(b4,b7))),function(){return bN.Bind(bf.SyncElemNodesNextFrame(b3,b4),function(){return bN.Bind(T.Play(b9),function(){b4.PreviousNodes=b7;return bN.Return(null);});});});})):bf.SyncElemNodesNextFrame(b3,b4);};bf.SyncElemNodesNextFrame=function(b3,b4){function b5(b6){a.requestAnimationFrame(function(){bf.SyncElemNode(b3,b4.Top);b6();});}return $.BatchUpdatesEnabled()?bN.FromContinuations(function(b6,b7,b8){return b5.apply(null,[b6,b7,b8]);}):(bf.SyncElemNode(b3,b4.Top),bN.Return(null));};bf.ComputeEnterAnim=function(b3,b4){return T.Concat(bD.map(function(b5){return _6.GetEnterAnim(b5.Attr);},bd.ToArray(bd.Except(b3.PreviousNodes,bd.Filter(function(b5){return _6.HasEnterAnim(b5.Attr);},b4)))));};bf.ComputeChangeAnim=function(b3,b4){var b5;function b6(b7){return _6.HasChangeAnim(b7.Attr);}b5=function(b7){return bd.Filter(b6,b7);};return T.Concat(bD.map(function(b7){return _6.GetChangeAnim(b7.Attr);},bd.ToArray(bd.Intersect(b5(b3.PreviousNodes),b5(b4)))));};bf.ComputeExitAnim=function(b3,b4){return T.Concat(bD.map(function(b5){return _6.GetExitAnim(b5.Attr);},bd.ToArray(bd.Except(b4,bd.Filter(function(b5){return _6.HasExitAnim(b5.Attr);},b3.PreviousNodes)))));};bf.CreateDelimitedRunState=function(b3,b4,b5){return be.New(bd.get_Empty(),bf.CreateDelimitedElemNode(b3,b4,_6.EmptyAttr(),b5));};bf.CreateRunState=function(b3,b4){return be.New(bd.get_Empty(),bf.CreateElemNode(b3,_6.EmptyAttr(),b4));};bf.CreateDelimitedElemNode=function(b3,b4,b5,b6){var b7,b8;b7=b3.parentNode;bf.LinkPrevElement(b4,b6);b8=_6.Insert(b7,b5);return ba.New(b8,b6,{$:1,$0:[b3,b4]},b7,h.Int(),bK.GetOptional(b8.OnAfterRender));};bf.CreateElemNode=function(b3,b4,b5){var b6;bf.LinkElement(b3,b5);b6=_6.Insert(b3,b4);return ba.New(b6,b5,null,b3,h.Int(),bK.GetOptional(b6.OnAfterRender));};bf.SyncElemNode=function(b3,b4){!b3?bf.SyncElement(b4):void 0;bf.Sync(b4.Children);bf.AfterRender(b4);};bf.Sync=function(b3){var b4,b5,b6,b7,b8;while(true){if(b3!=null&&b3.$==1)return bf.SyncElemNode(false,b3.$0);else if(b3!=null&&b3.$==2){b6=b3.$0;b3=b6.Current;}else if(b3==null)return null;else if(b3!=null&&b3.$==5)return null;else if(b3!=null&&b3.$==4){b4=b3.$0;return b4.Dirty?(b4.Text.nodeValue=b4.Value,b4.Dirty=false):null;}else if(b3!=null&&b3.$==6){b5=b3.$0;bD.iter(function(b9){bf.SyncElemNode(false,b9);},b5.Holes);bD.iter(function(b9){_6.Sync(b9[0],b9[1]);},b5.Attrs);return bf.AfterRender(b5);}else{b7=b3.$1;b8=b3.$0;bf.Sync(b8);b3=b7;}}};bf.AfterRender=function(b3){var b4;b4=bK.GetOptional(b3.Render);if(b4!=null&&b4.$==1){b4.$0(b3.El);bK.SetOptional(b3,"Render",null);}};bf.InsertBeforeDelim=function(b3,b4){var b5,b6;b5=b3.parentNode;b6=self.document.createTextNode("");b5.insertBefore(b6,b3);bf.LinkPrevElement(b3,b4);return b6;};bf.LinkPrevElement=function(b3,b4){bf.InsertDoc(b3.parentNode,b4,b3);};bf.LinkElement=function(b3,b4){bf.InsertDoc(b3,b4,null);};bf.SyncElement=function(b3){function b4(b5){function b6(b7){var b8,b9,b_,b$;while(true){if(b7!=null&&b7.$==0){b9=b7.$1;b_=b7.$0;if(b6(b_))return true;else b7=b9;}else if(b7!=null&&b7.$==2){b$=b7.$0;if(b$.Dirty)return true;else b7=b$.Current;}else return b7!=null&&b7.$==6&&(b8=b7.$0,b8.Dirty||bD.exists(b4,b8.Holes));}}return b6(b5.Children);}_6.Sync(b3.El,b3.Attr);if(b4(b3))bf.DoSyncElement(b3);};bf.DoSyncElement=function(b3){var b4,b5,b6;function b7(b8,b9){var b_,b$,ca,cb;while(true){if(b8!=null&&b8.$==1)return b8.$0.El;else if(b8!=null&&b8.$==2){b$=b8.$0;if(b$.Dirty){b$.Dirty=false;return bf.InsertDoc(b4,b$.Current,b9);}else b8=b$.Current;}else if(b8==null)return b9;else if(b8!=null&&b8.$==4)return b8.$0.Text;else if(b8!=null&&b8.$==5)return b8.$0;else if(b8!=null&&b8.$==6){b_=b8.$0;b_.Dirty?b_.Dirty=false:void 0;return bD.foldBack(function(cc,cd){return cc==null||cc.constructor===a.Object?b7(cc,cd):cc;},b_.Els,b9);}else{ca=b8.$1;cb=b8.$0;b8=cb;b9=b7(ca,b9);}}}b4=b3.El;bc.Iter((b5=b3.El,function(b8){r.RemoveNode(b5,b8);}),bc.Except(bc.DocChildren(b3),bc.Children(b3.El,bK.GetOptional(b3.Delimiters))));b7(b3.Children,(b6=bK.GetOptional(b3.Delimiters),b6!=null&&b6.$==1?b6.$0[1]:null));};bf.InsertDoc=function(b3,b4,b5){var b6,b7,b8;while(true)if(b4!=null&&b4.$==1)return bf.InsertNode(b3,b4.$0.El,b5);else if(b4!=null&&b4.$==2){b6=b4.$0;b6.Dirty=false;b4=b6.Current;}else if(b4==null)return b5;else if(b4!=null&&b4.$==4)return bf.InsertNode(b3,b4.$0.Text,b5);else if(b4!=null&&b4.$==5)return bf.InsertNode(b3,b4.$0,b5);else if(b4!=null&&b4.$==6)return bD.foldBack(function(b9,b_){return(((bK.Curried3(function(b$,ca,cb){return ca==null||ca.constructor===a.Object?bf.InsertDoc(b$,ca,cb):bf.InsertNode(b$,ca,cb);}))(b3))(b9))(b_);},b4.$0.Els,b5);else{b7=b4.$1;b8=b4.$0;b4=b8;b5=bf.InsertDoc(b3,b7,b5);}};bf.InsertNode=function(b3,b4,b5){r.InsertAt(b3,b5,b4);return b4;};bg=c.Doc=bK.Class({ReplaceInDom:function(b3){var b4;b4=self.document.createTextNode("");b3.parentNode.replaceChild(b4,b3);bg.RunBefore(b4,this);}},k,bg);bg.SvgElementMixed=function(b3,b4){var b5;b5=bg.MixedNodes(b4);return bg.SvgElement(b3,b5[0],b5[1]);};bg.SvgElement=function(b3,b4,b5){var b6,b7;b6=_2.Concat(b4);b7=bg.Concat(b5);return bh.New(self.document.createElementNS("http://www.w3.org/2000/svg",b3),b6,b7);};bg.ElementMixed=function(b3,b4){var b5;b5=bg.MixedNodes(b4);return bg.Element(b3,b5[0],b5[1]);};bg.ConcatMixed=function(b3){return bg.Concat(bJ.map(bg.ToMixedDoc,b3));};bg.MixedNodes=function(b3){var b4,b5,b6,b7;b4=bK.MarkResizable([]);b5=bK.MarkResizable([]);b6=bE.Get(b3);try{while(b6.MoveNext()){b7=b6.Current();if(b7 instanceof _2)b4.push(b7);else b5.push(bg.ToMixedDoc(b7));}}finally{if(typeof b6=="object"&&"Dispose"in b6)b6.Dispose();}return[b4,b5];};bg.ToMixedDoc=function(b3){return b3 instanceof bg?b3:typeof b3=="string"?bg.TextNode(b3):b3 instanceof a.Element?bg.StaticProxy(b3):typeof b3=="function"?bg.EmbedView(y.Map(bg.ToMixedDoc,b3)):b3 instanceof x?bg.EmbedView(y.Map(bg.ToMixedDoc,b3.get_View())):bL.Equals(b3,null)?bg.get_Empty():bg.TextNode(a.String(b3));};bg.Element=function(b3,b4,b5){var b6,b7;b6=_2.Concat(b4);b7=bg.Concat(b5);return bh.New(self.document.createElement(b3),b6,b7);};bg.Radio=function(b3,b4,b5){var b6,b7;b6=self.document.createElement("input");b6.addEventListener("click",function(){return b5.Set(b4);},false);b7=_9.DynamicProp("checked",y.Map(function(b8){return bL.Equals(b8,b4);},b5.get_View()));return bh.New(b6,_2.Concat(bC.append(bC.ofArray([_2.Create("type","radio"),_2.Create("name",b5.get_Id()),b7]),bC.ofSeq(b3))),bg.get_Empty());};bg.LinkView=function(b3,b4,b5,b6){var b7;b7=_2.Concat(bJ.append([_9.HandlerView("click",b5,function(){return function(){return b6;};}),_2.Create("href","#")],b4));return bh.New(self.document.createElement("a"),b7,bg.TextNode(b3));};bg.Link=function(b3,b4,b5){var b6,b7;b6=(b7=_2.Concat(b4),_2.Append(_2.Create("href","#"),b7));return bh.New(bg.Clickable("a",b5),b6,bg.TextNode(b3));};bg.ButtonView=function(b3,b4,b5,b6){var b7;b7=_2.Concat(bJ.append([_9.HandlerView("click",b5,function(){return function(){return b6;};})],b4));return bh.New(self.document.createElement("button"),b7,bg.TextNode(b3));};bg.Button=function(b3,b4,b5){var b6;b6=_2.Concat(b4);return bh.New(bg.Clickable("button",b5),b6,bg.TextNode(b3));};bg.Clickable=function(b3,b4){var b5;b5=self.document.createElement(b3);b5.addEventListener("click",function(b6){b6.preventDefault();return b4();},false);return b5;};bg.CheckBoxGroup=function(b3,b4,b5){function b6(b7){return bL.Equals(b4,b7);}return bg.CheckBox(b3,A.Lens(b5,function(b7){return bC.exists(b6,b7);},function(b7,b8){return b8?bC.exists(function(b9){return bL.Equals(b4,b9);},b7)?b7:new bC.T({$:1,$0:b4,$1:b7}):bC.filter(function(b9){return!bL.Equals(b4,b9);},b7);}));};bg.CheckBox=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[_2.Create("type","checkbox"),_9.Checked(b4)]);});};bg.SelectDynOptional=function(b3,b4,b5,b6,b7){return bg.SelectDyn(b3,function(b8){return b8!=null&&b8.$==1?b5(b8.$0):b4;},y.Map(function(b8){return new bC.T({$:1,$0:null,$1:bC.map(function(b9){return{$:1,$0:b9};},b8)});},b6),b7);};bg.SelectOptional=function(b3,b4,b5,b6,b7){return bg.Select(b3,function(b8){return b8!=null&&b8.$==1?b5(b8.$0):b4;},new bC.T({$:1,$0:null,$1:bC.map(function(b8){return{$:1,$0:b8};},b6)}),b7);};bg.Select=function(b3,b4,b5,b6){return bg.SelectImpl(b3,b4,function(b7){b7[0]=b5;return bg.Concat(bC.mapi(function(b8,b9){return bg.Element("option",bC.ofArray([_2.Create("value",a.String(b8))]),bC.ofArray([bg.TextNode(b4(b9))]));},b5));},b6);};bg.SelectDyn=function(b3,b4,b5,b6){return bg.SelectImpl(b3,b4,function(b7){function b8(b9,b_){return bg.Element("option",bC.ofArray([_2.Create("value",a.String(b9))]),bC.ofArray([bg.TextNode(b4(b_))]));}return bg.Convert(function(b9){return b8(b9[0],b9[1]);},y.Map(function(b9){b7[0]=b9;return bJ.mapi(function(b_,b$){return[b_,b$];},b9);},b5));},b6);};bg.SelectImpl=function(b3,b4,b5,b6){var b7,b8,b9,b_;function b$(ce){return ce.selectedIndex;}function ca(ce,cf){ce.selectedIndex=cf;}function cb(ce){var cf;cf=b$(ce);return b7[0].get_Item(cf);}function cc(ce){return bJ.findIndex(function(cf){return bL.Equals(ce,cf);},b7[0]);}function cd(ce,cf){return ca(ce,cc(cf));}b7=[bC.T.Empty];b8=self.document.createElement("select");b9=_9.DynamicCustom(function(ce){return function(cf){return cd(ce,cf);};},b6.get_View());b8.addEventListener("change",function(){b6.UpdateMaybe(function(ce){var cf;cf=cb(b8);return bL.Equals(ce,cf)?null:{$:1,$0:cf};});},false);return bh.New(b8,(b_=_2.Append(b9,_2.Concat(b3)),_2.Append(_9.OnAfterRender(function(ce){cd(ce,b6.Get());}),b_)),b5(b7));};bg.InputArea=function(b3,b4){return bg.InputInternal("textarea",function(){return bJ.append(b3,[_9.Value(b4)]);});};bg.FloatInput=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[_9.FloatValue(b4),_2.Create("type","number")]);});};bg.FloatInputUnchecked=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[b4.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.FloatValueUnchecked(b4),_2.Create("type","number")]);});};bg.IntInput=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[_9.IntValue(b4),_2.Create("type","number")]);});};bg.IntInputUnchecked=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[b4.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.IntValueUnchecked(b4),_2.Create("type","number")]);});};bg.PasswordBox=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[_9.Value(b4),_2.Create("type","password")]);});};bg.Input=function(b3,b4){return bg.InputInternal("input",function(){return bJ.append(b3,[_9.Value(b4)]);});};bg.InputInternal=function(b3,b4){var b5;b5=self.document.createElement(b3);return bh.New(b5,_2.Concat(b4(b5)),bg.get_Empty());};bg.ConvertSeqVarBy=function(b3,b4,b5){return bg.Flatten(A.MapLens(b3,b4,b5));};bg.ConvertSeqBy=function(b3,b4,b5){return bg.Flatten(y.MapSeqCachedViewBy(b3,function(b6,b7){return(b4(b6))(b7);},b5));};bg.ConvertSeq=function(b3,b4){return bg.Flatten(y.MapSeqCachedView(b3,b4));};bg.ConvertBy=function(b3,b4,b5){return bg.Flatten(y.MapSeqCachedBy(b3,b4,b5));};bg.Convert=function(b3,b4){return bg.Flatten(y.MapSeqCached(b3,b4));};bg.Flatten=function(b3){return bg.EmbedView(y.Map(bg.Concat,b3));};bg.TextView=function(b3){var b4;b4=bf.CreateTextNode();return bg.Mk({$:4,$0:b4},y.Map(function(b5){bf.UpdateTextNode(b4,b5);},b3));};bg.RunReplaceById=function(b3,b4){var b5;b5=self.document.getElementById(b3);if(bL.Equals(b5,null))bQ.FailWith("invalid id: "+b3);else b4.ReplaceInDom(b5);};bg.RunById=function(b3,b4){var b5;b5=self.document.getElementById(b3);if(bL.Equals(b5,null))bQ.FailWith("invalid id: "+b3);else bg.Run(b5,b4);};bg.Run=function(b3,b4){bf.LinkElement(b3,b4.docNode);bg.RunInPlace(false,b3,b4);};bg.RunInPlace=function(b3,b4,b5){var b6;b6=bf.CreateRunState(b4,b5.docNode);y.Sink(T.get_UseAnimations()||$.BatchUpdatesEnabled()?n.StartProcessor(bf.PerformAnimatedUpdate(b3,b6,b5.docNode)):function(){bf.PerformSyncUpdate(b3,b6,b5.docNode);},b5.updates);};bg.RunPrependById=function(b3,b4){var b5;b5=self.document.getElementById(b3);if(bL.Equals(b5,null))bQ.FailWith("invalid id: "+b3);else bg.RunPrepend(b5,b4);};bg.RunPrepend=function(b3,b4){var b5;b5=self.document.createTextNode("");b3.insertBefore(b5,b3.firstChild);bg.RunBefore(b5,b4);};bg.RunAppendById=function(b3,b4){var b5;b5=self.document.getElementById(b3);if(bL.Equals(b5,null))bQ.FailWith("invalid id: "+b3);else bg.RunAppend(b5,b4);};bg.RunAppend=function(b3,b4){var b5;b5=self.document.createTextNode("");b3.appendChild(b5);bg.RunBefore(b5,b4);};bg.RunAfterById=function(b3,b4){var b5;b5=self.document.getElementById(b3);if(bL.Equals(b5,null))bQ.FailWith("invalid id: "+b3);else bg.RunAfter(b5,b4);};bg.RunAfter=function(b3,b4){var b5;b5=self.document.createTextNode("");b3.parentNode.insertBefore(b5,b3.nextSibling);bg.RunBetween(b3,b5,b4);};bg.RunBeforeById=function(b3,b4){var b5;b5=self.document.getElementById(b3);if(bL.Equals(b5,null))bQ.FailWith("invalid id: "+b3);else bg.RunBefore(b5,b4);};bg.RunBefore=function(b3,b4){var b5;b5=self.document.createTextNode("");b3.parentNode.insertBefore(b5,b3);bg.RunBetween(b5,b3,b4);};bg.RunBetween=function(b3,b4,b5){var b6;bf.LinkPrevElement(b4,b5.docNode);b6=bf.CreateDelimitedRunState(b3,b4,b5.docNode);y.Sink(T.get_UseAnimations()||$.BatchUpdatesEnabled()?n.StartProcessor(bf.PerformAnimatedUpdate(false,b6,b5.docNode)):function(){bf.PerformSyncUpdate(false,b6,b5.docNode);},b5.updates);};bg.Async=function(b3){return bg.EmbedView(y.MapAsync(a.id,y.Const(b3)));};bg.BindView=function(b3,b4){return bg.EmbedView(y.Map(b3,b4));};bg.EmbedView=function(b3){var b4;b4=bf.CreateEmbedNode();return bg.Mk({$:2,$0:b4},y.Map(a.ignore,y.Bind(function(b5){bf.UpdateEmbedNode(b4,b5.docNode);return b5.updates;},b3)));};bg.Verbatim=function(b3){return bg.Mk(d.MapTreeReduce(function(b4){return bL.Equals(b4.nodeType,bW.TEXT_NODE)?{$:5,$0:b4}:{$:1,$0:bf.CreateElemNode(b4,_6.EmptyAttr(),null)};},null,function(b4,b5){return{$:0,$0:b4,$1:b5};},r.ChildrenArray(r.ParseHTMLIntoFakeRoot(b3))),y.Const());};bg.StaticProxy=function(b3){return bh.New(b3,_6.EmptyAttr(),bg.get_Empty());};bg.TextNode=function(b3){return bg.Mk({$:5,$0:self.document.createTextNode(b3)},y.Const());};bg.get_Empty=function(){return bg.Mk(null,y.Const());};bg.Concat=function(b3){var b4;b4=d.ofSeqNonCopying(b3);return d.TreeReduce(bg.get_Empty(),bg.Append,b4);};bg.Append=function(b3,b4){return bg.Mk({$:0,$0:b3.docNode,$1:b4.docNode},y.Map2Unit(b3.updates,b4.updates));};bg.Mk=function(b3,b4){return new bg.New(b3,b4);};bg.New=bK.Ctor(function(b3,b4){k.New.call(this);this.docNode=b3;this.updates=b4;},bg);bh=c.Elt=bK.Class({SetStyle:function(b3,b4){this.elt.style[b3]=b4;},HasClass:function(b3){return(new a.RegExp("(\\s|^)"+b3+"(\\s|$)")).test(this.elt.className);},GetProperty:function(b3){return this.elt[b3];},SetProperty:function(b3,b4){this.elt[b3]=b4;},RemoveAttribute:function(b3){this.elt.removeAttribute(b3);},HasAttribute:function(b3){return this.elt.hasAttribute(b3);},GetAttribute:function(b3){return this.elt.getAttribute(b3);},SetAttribute:function(b3,b4){this.elt.setAttribute(b3,b4);},SetText:function(b3){var b4;b4=this.docNode$1;if(b4!=null&&b4.$==1)b4.$0.Children=null;else b4!=null&&b4.$==6?(b4.$0.Els=[],this.ClearHoles()):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=b3;},GetText:function(){return this.elt.textContent;},SetValue:function(b3){this.elt.value=b3;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var b3;b3=this.docNode$1;if(b3!=null&&b3.$==1)b3.$0.Children=null;else b3!=null&&b3.$==6?(b3.$0.Els=[],this.ClearHoles()):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(b3){var b4,b5,b6,b7,b8;b4=this.docNode$1;if(b4!=null&&b4.$==1){b5=b4.$0;b5.Children={$:0,$0:b3.docNode,$1:b5.Children};bf.InsertDoc(this.elt,b3.docNode,(b6=this.elt.firstChild,bL.Equals(b6,null)?null:b6));}else b4!=null&&b4.$==6?(b7=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),b8=bf.InsertBeforeDelim(b7,b3.docNode),this.AddHole(ba.New(_6.Empty(this.elt),b3.docNode,{$:1,$0:[b8,b7]},this.elt,h.Int(),null))):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b3.updates));},Append:function(b3){var b4,b5,b6,b7;b4=this.docNode$1;if(b4!=null&&b4.$==1){b5=b4.$0;b5.Children={$:0,$0:b5.Children,$1:b3.docNode};bf.InsertDoc(this.elt,b3.docNode,null);}else b4!=null&&b4.$==6?(b6=this.elt.appendChild(self.document.createTextNode("")),b7=bf.InsertBeforeDelim(b6,b3.docNode),this.AddHole(ba.New(_6.Empty(this.elt),b3.docNode,{$:1,$0:[b7,b6]},this.elt,h.Int(),null))):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b3.updates));},ToUpdater:function(){var b3,b4,b5;return new bi.New((b3=this.docNode$1,b3!=null&&b3.$==1?bK.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,b3.$0.Attr]],Render:(b4=null,b4?b4.$0:void 0),El:(b5={$:1,$0:this.elt},b5?b5.$0:void 0)},["Render","El"]):b3!=null&&b3.$==6?b3.$0:bQ.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,A.Create$1([]));},OnAfterRenderView:function(b3,b4){var b5,b6;b5=this;b6=h.Id();this.Append(bg.BindView(function(b7){b5.elt[b6]=b7;return bg.get_Empty();},b3));return this["OnAfterRender'"](function(b7){b4(b7,b7[b6]);});},OnAfterRender:function(b3){return this["OnAfterRender'"](b3);},"OnAfterRender'":function(b3){var b4,b5,b6,b7,b8,b9,b_;b4=this.docNode$1;if(b4!=null&&b4.$==1){b5=b4.$0;bK.SetOptional(b5,"Render",(b6=bK.GetOptional(b5.Render),b6!=null&&b6.$==1?(b7=b6.$0,{$:1,$0:function(b$){b7(b$);b3(b$);}}):{$:1,$0:b3}));}else b4!=null&&b4.$==6?(b8=b4.$0,bK.SetOptional(b8,"Render",(b9=bK.GetOptional(b8.Render),b9!=null&&b9.$==1?(b_=b9.$0,{$:1,$0:function(b$){b_(b$);b3(b$);}}):{$:1,$0:b3}))):bQ.FailWith("Invalid docNode in Elt");return this;},onView:function(b3,b4,b5){var b6;b6=b5(this.elt);this.elt.addEventListener(b3,function(b7){return y.Get(b6(b7),b4);},false);return this;},on:function(b3,b4){var b5;b5=this;this.elt.addEventListener(b3,function(b6){return b4(b5.elt,b6);},false);return this;},ClearHoles:function(){var b3;b3=this.docNode$1;if(b3!=null&&b3.$==6)b3.$0.Holes=[];},AddHole:function(b3){var b4;b4=this.docNode$1;if(b4!=null&&b4.$==6)b4.$0.Holes.push(b3);}},bg,bh);bh.TreeNode=function(b3,b4){var b5,b6;function b7(b8,b9){return _6.Updates(b9);}b5=B.Create(b4);return new bh.New$1({$:6,$0:b3},y.Map2Unit((b6=bD.map(function(b8){return b7(b8[0],b8[1]);},b3.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,b6)),b5.v),bD.get(b3.Els,0),b5);};bh.New=function(b3,b4,b5){var b6,b7;b6=bf.CreateElemNode(b3,b4,b5.docNode);b7=B.Create(b5.updates);return new bh.New$1({$:1,$0:b6},y.Map2Unit(_6.Updates(b6.Attr),b7.v),b3,b7);};bh.New$1=bK.Ctor(function(b3,b4,b5,b6){bg.New.call(this,b3,b4);this.docNode$1=b3;this.updates$1=b4;this.elt=b5;this.rvUpdates=b6;},bh);bi=_3.EltUpdater=bK.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(b3){this.origHoles.push(b3);this.treeNode.Holes=this.treeNode.Holes.concat([b3]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(b3){var b4,b5;function b6(b7){return b7!==b5;}b4=b3.docNode;if(b4!=null&&b4.$==1){b5=b4.$0.ElKey;this.treeNode.Holes=bD.filter(function(b7){return b7.ElKey!==b5;},this.treeNode.Holes);this.holeUpdates.Set(bD.filter(function(b7){return b6(b7[0]);},this.holeUpdates.Get()));}else bQ.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(b3){var b4,b5,b6;b4=b3.docNode;if(b4!=null&&b4.$==1){b5=b4.$0;this.treeNode.Holes=this.treeNode.Holes.concat([b5]);b6=this.holeUpdates.Get();b6.push([b5.ElKey,b3.updates]);this.holeUpdates.Set(b6);}else bQ.FailWith("DocUpdater.AddUpdated expects a single element node");}},bh,bi);bi.New=bK.Ctor(function(b3,b4,b5,b6,b7){var b8,b9,b_,b$;function ca(cb){return cb[1];}bh.New$1.call(this,{$:6,$0:b3},y.Map2Unit(b4,(b8=b7.get_View(),y.BindInner((b9=function(cb){return bD.map(ca,cb);},(b_=(b$=y.Const(),function(cb){return d.TreeReduce(b$,y.Map2Unit,cb);}),function(cb){return b_(b9(cb));})),b8))),b5,b6);this.treeNode=b3;this.holeUpdates=b7;this.origHoles=this.treeNode.Holes;},bi);bj.$cctor=function(){bj.$cctor=a.ignore;bj.BatchUpdatesEnabled=true;};bl.failNotLoaded=function(b3){bM.warn("Instantiating non-loaded template",b3);};bl.fill=function(b3,b4,b5){while(true)if(b3.hasChildNodes())b5=b4.insertBefore(b3.lastChild,b5);else return null;};bl.fillTextHole=function(b3,b4,b5){var b6;b6=b3.querySelector("[ws-replace]");return bL.Equals(b6,null)?(bM.warn("Filling non-existent text hole",b5),null):(b6.parentNode.replaceChild(self.document.createTextNode(b4),b6),{$:1,$0:b6.getAttribute("ws-replace")});};bl.removeHolesExcept=function(b3,b4){function b5(b6){bk.foreachNotPreserved(b3,"["+b6+"]",function(b7){if(!b4.Contains(b7.getAttribute(b6)))b7.removeAttribute(b6);});}b5("ws-attr");b5("ws-onafterrender");b5("ws-var");bk.foreachNotPreserved(b3,"[ws-hole]",function(b6){if(!b4.Contains(b6.getAttribute("ws-hole"))){b6.removeAttribute("ws-hole");while(b6.hasChildNodes())b6.removeChild(b6.lastChild);}});bk.foreachNotPreserved(b3,"[ws-replace]",function(b6){if(!b4.Contains(b6.getAttribute("ws-replace")))b6.parentNode.removeChild(b6);});bk.foreachNotPreserved(b3,"[ws-on]",function(b6){b6.setAttribute("ws-on",bF.concat(" ",bD.filter(function(b7){return b4.Contains(bD.get(bF.SplitChars(b7,[":"],1),1));},bF.SplitChars(b6.getAttribute("ws-on"),[" "],1))));});bk.foreachNotPreserved(b3,"[ws-attr-holes]",function(b6){var b7,b8,b9,b_,b$;b7=bF.SplitChars(b6.getAttribute("ws-attr-holes"),[" "],1);for(b8=0,b9=b7.length-1;b8<=b9;b8++){b_=bD.get(b7,b8);b6.setAttribute(b_,(b$=new a.RegExp(bk.TextHoleRE(),"g"),b6.getAttribute(b_).replace(b$,function(ca,cb){return b4.Contains(cb)?ca:"";})));}});};bl.fillInstanceAttrs=function(b3,b4){var b5,b6,b7,b8,b9;bl.convertAttrs(b4);b5=b4.nodeName.toLowerCase();b6=b3.querySelector("[ws-attr="+b5+"]");if(bL.Equals(b6,null))bM.warn("Filling non-existent attr hole",b5);else{b6.removeAttribute("ws-attr");for(b7=0,b8=b4.attributes.length-1;b7<=b8;b7++){b9=b4.attributes.item(b7);if(b9.name==="class"&&b6.hasAttribute("class"))b6.setAttribute("class",b6.getAttribute("class")+" "+b9.nodeValue);else b6.setAttribute(b9.name,b9.nodeValue);}}};bl.mapHoles=function(b3,b4){function b5(b6){bk.foreachNotPreserved(b3,"["+b6+"]",function(b7){var b8,b9;b8=(b9=null,[b4.TryGetValue(b7.getAttribute(b6).toLowerCase(),{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);if(b8[0])b7.setAttribute(b6,b8[1]);});}b5("ws-hole");b5("ws-replace");b5("ws-attr");b5("ws-onafterrender");b5("ws-var");bk.foreachNotPreserved(b3,"[ws-on]",function(b6){b6.setAttribute("ws-on",bF.concat(" ",bD.map(function(b7){var b8,b9,b_;b8=bF.SplitChars(b7,[":"],1);b9=(b_=null,[b4.TryGetValue(bD.get(b8,1),{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?bD.get(b8,0)+":"+b9[1]:b7;},bF.SplitChars(b6.getAttribute("ws-on"),[" "],1))));});bk.foreachNotPreserved(b3,"[ws-attr-holes]",function(b6){var b7,b8,b9;b7=bF.SplitChars(b6.getAttribute("ws-attr-holes"),[" "],1);for(b8=0,b9=b7.length-1;b8<=b9;b8++)(function(){var b_;function b$(ca,cb){var cc;cc=bQ.KeyValue(cb);return ca.replace(new a.RegExp("\\${"+cc[0]+"}","ig"),"${"+cc[1]+"}");}b_=bD.get(b7,b8);return b6.setAttribute(b_,(((bK.Curried3(bJ.fold))(b$))(b6.getAttribute(b_)))(b4));}());});};bl.convertTextNode=function(b3){var b4,b5,b6,b7,b8,b9;b4=null;b5=0;b7=b3.textContent;b8=new a.RegExp(bk.TextHoleRE(),"g");while(b4=b8.exec(b7),b4!==null){b3.parentNode.insertBefore(self.document.createTextNode(bX.string(b7,{$:1,$0:b5},{$:1,$0:b8.lastIndex-bD.get(b4,0).length-1})),b3);b5=b8.lastIndex;b9=self.document.createElement("span");b9.setAttribute("ws-replace",bD.get(b4,1).toLowerCase());b3.parentNode.insertBefore(b9,b3);}b8.lastIndex=0;b3.textContent=bX.string(b7,{$:1,$0:b5},null);};bl.convertAttrs=function(b3){var b5,b6,b7,b8,b9,b_,b$,ca;function b4(cb){var cc;cc=b3.getAttribute(cb);if(cc===null);else b3.setAttribute(cb,cc.toLowerCase());}b5=b3.attributes;b6=[];b7=[];b8=[];for(b9=0,b_=b5.length-1;b9<=b_;b9++){b$=b5.item(b9);if(bF.StartsWith(b$.nodeName,"ws-on")&&b$.nodeName!=="ws-onafterrender"&&b$.nodeName!=="ws-on"){b6.push(b$.nodeName);b7.push(bX.string(b$.nodeName,{$:1,$0:"ws-on".length},null)+":"+b$.nodeValue.toLowerCase());}else!bF.StartsWith(b$.nodeName,"ws-")&&(new a.RegExp(bk.TextHoleRE())).test(b$.nodeValue)?(b$.nodeValue=(ca=new a.RegExp(bk.TextHoleRE(),"g"),b$.nodeValue.replace(ca,function(cb,cc){return"${"+cc.toLowerCase()+"}";})),b8.push(b$.nodeName)):void 0;}if(!(b7.length==0))b3.setAttribute("ws-on",bF.concat(" ",b7));if(!(b8.length==0))b3.setAttribute("ws-attr-holes",bF.concat(" ",b8));b4("ws-hole");b4("ws-replace");b4("ws-attr");b4("ws-onafterrender");b4("ws-var");bD.iter(function(cb){b3.removeAttribute(cb);},b6);};bk.GetOrLoadTemplate=function(b3,b4,b5,b6){bk.LoadLocalTemplates("");bk.PrepareTemplate(b3,b4,b5);return bk.NamedTemplate(b3,b4,b6);};bk.NamedTemplate=function(b3,b4,b5){var b6,b7;b6=(b7=null,[bk.LoadedTemplateFile(b3).TryGetValue(b4==null?"":b4.$0,{get:function(){return b7;},set:function(b8){b7=b8;}}),b7]);return b6[0]?bk.ChildrenTemplate(b6[1].cloneNode(true),b5):(bM.warn("Local template doesn't exist",b4),bg.get_Empty());};bk.RunFullDocTemplate=function(b3){var b4,b5,b6;return bk.RenderedFullDocTemplate()==null?(b4=(bk.LoadLocalTemplates(""),bk.PrepareTemplateStrict("",null,self.document.body,null),b5=bk.ChildrenTemplate(self.document.body,b3),b6=self.document.body,function(b7){bg.RunInPlace(true,b6,b7);}(b5),b5),(bk.set_RenderedFullDocTemplate({$:1,$0:b4}),b4)):bk.RenderedFullDocTemplate().$0;};bk.RenderedFullDocTemplate=function(){bm.$cctor();return bm.RenderedFullDocTemplate;};bk.set_RenderedFullDocTemplate=function(b3){bm.$cctor();bm.RenderedFullDocTemplate=b3;};bk.LoadLocalTemplates=function(b3){!bk.LocalTemplatesLoaded()?(bk.set_LocalTemplatesLoaded(true),bk.LoadNestedTemplates(self.document.body,"")):void 0;bk.LoadedTemplates().set_Item(b3,bk.LoadedTemplateFile(""));};bk.LoadNestedTemplates=function(b3,b4){var b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg;function b5(ch){var ci,cj;if(!b6.ContainsKey(ch)){ci=(cj=null,[b7.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);if(ci[0]){cg.SAdd(ch);b7.RemoveKey(ch);bk.PrepareTemplateStrict(b4,{$:1,$0:ch},ci[1],{$:1,$0:b5});}else bM.warn(cg.Contains(ch)?"Encountered loop when instantiating "+ch:"Local template does not exist: "+ch);}}b6=bk.LoadedTemplateFile(b4);b7=new bT.New$5();b8=b3.querySelectorAll("[ws-template]");for(b9=0,b_=b8.length-1;b9<=b_;b9++){b$=b8[b9];ca=b$.getAttribute("ws-template").toLowerCase();b$.removeAttribute("ws-template");b7.set_Item(ca,bk.FakeRootSingle(b$));}cb=b3.querySelectorAll("[ws-children-template]");for(cc=0,cd=cb.length-1;cc<=cd;cc++){ce=cb[cc];cf=ce.getAttribute("ws-children-template").toLowerCase();ce.removeAttribute("ws-children-template");b7.set_Item(cf,bk.FakeRoot(ce));}cg=new bI.New$3();while(b7.count>0)b5(bJ.head(b7.Keys()));};bk.PrepareTemplate=function(b3,b4,b5){if(!bk.LoadedTemplateFile(b3).ContainsKey(b4==null?"":b4.$0))bk.PrepareTemplateStrict(b3,b4,b5(),null);};bk.PrepareSingleTemplate=function(b3,b4,b5){var b6;b6=bk.FakeRootSingle(b5);return function(b7){bk.PrepareTemplateStrict(b3,b4,b6,b7);};};bk.PrepareTemplateStrict=function(b3,b4,b5,b6){var b7;function b8(cc,cd){var ce,cf,cg,ch,ci,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE;function cj(cF){}while(true)switch(cc){case 0:if(cd!==null){ce=cd.nextSibling;if(bL.Equals(cd.nodeType,bW.TEXT_NODE))bl.convertTextNode(cd);else if(bL.Equals(cd.nodeType,bW.ELEMENT_NODE))b_(cd);cd=ce;}else return null;break;case 1:ck=bX.string(cd.nodeName,{$:1,$0:3},null).toLowerCase();cl=(cf=ck.indexOf("."),cf===-1?[b3,ck]:[bX.string(ck,null,{$:1,$0:cf-1}),bX.string(ck,{$:1,$0:cf+1},null)]);cm=cl[1];cn=cl[0];if(cn!==""&&!bk.LoadedTemplates().ContainsKey(cn))return bl.failNotLoaded(cm);else{if(cn===""&&b6!=null)b6.$0(cm);co=bk.LoadedTemplates().Item(cn);if(!co.ContainsKey(cm))return bl.failNotLoaded(cm);else{cp=co.Item(cm);cq=cp.cloneNode(true);cr=new bI.New$3();cs=new bT.New$5();ct=cd.attributes;for(cu=0,cv=ct.length-1;cu<=cv;cu++){cw=ct.item(cu).name.toLowerCase();cs.set_Item(cw,(cx=ct.item(cu).nodeValue,cx===""?cw:cx.toLowerCase()));if(!cr.SAdd(cw))bM.warn("Hole mapped twice",cw);}for(cy=0,cz=cd.childNodes.length-1;cy<=cz;cy++){cA=cd.childNodes[cy];if(bL.Equals(cA.nodeType,bW.ELEMENT_NODE))!cr.SAdd(cA.nodeName.toLowerCase())?bM.warn("Hole filled twice",cm):void 0;}cB=cd.childNodes.length===1&&bL.Equals(cd.firstChild.nodeType,bW.TEXT_NODE);if(cB){ch=bl.fillTextHole(cq,cd.firstChild.textContent,cm);((function(cF){return function(cG){if(cG!=null)cF(cG.$0);};}((ci=function(cF){return function(cG){return cF.SAdd(cG);};}(cr),function(cF){return cj(ci(cF));})))(ch));}bl.removeHolesExcept(cq,cr);if(!cB){for(cC=0,cD=cd.childNodes.length-1;cC<=cD;cC++){cE=cd.childNodes[cC];if(bL.Equals(cE.nodeType,bW.ELEMENT_NODE))cE.hasAttributes()?bl.fillInstanceAttrs(cq,cE):b9(cq,cE);}}bl.mapHoles(cq,cs);bl.fill(cq,cd.parentNode,cd);cd.parentNode.removeChild(cd);return;}}break;}}function b9(cc,cd){var ce,cg,ch;function cf(ci,cj){var ck;if(cg==="title"&&cd.hasChildNodes()){ck=r.ParseHTMLIntoFakeRoot(cd.textContent);cd.removeChild(cd.firstChild);while(ck.hasChildNodes())cd.appendChild(ck.firstChild);}else null;b_(cd);return bl.fill(cd,ci,cj);}cg=cd.nodeName.toLowerCase();bk.foreachNotPreserved(cc,"[ws-attr-holes]",function(ci){var cj,ck,cl,cm,cn;cj=bF.SplitChars(ci.getAttribute("ws-attr-holes"),[" "],1);for(ck=0,cl=cj.length-1;ck<=cl;ck++){cm=bD.get(cj,ck);ci.setAttribute(cm,(cn=new a.RegExp("\\${"+cg+"}","ig"),ci.getAttribute(cm).replace(cn,cd.textContent)));}});ch=cc.querySelector("[ws-hole="+cg+"]");if(bL.Equals(ch,null)){ce=cc.querySelector("[ws-replace="+cg+"]");return bL.Equals(ce,null)?null:(cf(ce.parentNode,ce),void ce.parentNode.removeChild(ce));}else{while(ch.hasChildNodes())ch.removeChild(ch.lastChild);ch.removeAttribute("ws-hole");return cf(ch,null);}}function b_(cc){if(!cc.hasAttribute("ws-preserve"))if(bF.StartsWith(cc.nodeName.toLowerCase(),"ws-"))ca(cc);else{bl.convertAttrs(cc);b$(cc.firstChild);}}function b$(cc){return b8(0,cc);}function ca(cc){return b8(1,cc);}function cb(cc){var cd,ce,cf,cg;while(true){cd=cc.querySelector("[ws-template]");if(bL.Equals(cd,null)){ce=cc.querySelector("[ws-children-template]");if(bL.Equals(ce,null))return null;else{cf=ce.getAttribute("ws-children-template");ce.removeAttribute("ws-children-template");bk.PrepareTemplateStrict(b3,{$:1,$0:cf},ce,null);cc=cc;}}else{cg=cd.getAttribute("ws-template");(bk.PrepareSingleTemplate(b3,{$:1,$0:cg},cd))(null);cc=cc;}}}b7=(b4==null?"":b4.$0).toLowerCase();bk.LoadedTemplateFile(b3).set_Item(b7,b5);if(b5.hasChildNodes()){cb(b5);b$(b5.firstChild);}};bk.FakeRootSingle=function(b3){var b4,b5,b6,b7;b3.removeAttribute("ws-template");b4=b3.getAttribute("ws-replace");if(b4===null);else{b3.removeAttribute("ws-replace");b5=b3.parentNode;bL.Equals(b5,null)?void 0:(b6=self.document.createElement(b3.tagName),b6.setAttribute("ws-replace",b4),b5.replaceChild(b6,b3));}b7=self.document.createElement("div");b7.appendChild(b3);return b7;};bk.FakeRoot=function(b3){var b4;b4=self.document.createElement("div");while(b3.hasChildNodes())b4.appendChild(b3.firstChild);return b4;};bk.ChildrenTemplate=function(b3,b4){var b5,b6,b7,b8,b9;b5=bk.InlineTemplate(b3,bJ.append(b4,bk.GlobalHoles().Values()));b6=b5[1];b7=b5[0];b8=b7.Els;return!bL.Equals(b8,null)&&b8.length===1&&(bD.get(b8,0)instanceof bW&&(bL.Equals(bD.get(b8,0).nodeType,bW.ELEMENT_NODE)&&(b9=bD.get(b8,0),true)))?bh.TreeNode(b7,b6):bg.Mk({$:6,$0:b7},b6);};bk.InlineTemplate=function(b3,b4){var b5,b6,b7,b8,b$,ca,cb,cc,cd,ce,cf;function b9(cg,ch){var ci,cj,ck;ci=_6.Insert(cg,ch);ca.push(_6.Updates(ci));cb.push([cg,ci]);cj=bK.GetOptional(ci.OnAfterRender);return cj==null?null:(ck=cj.$0,void cc.push(function(){ck(cg);}));}function b_(cg){var ch,ci;ch=(ci=null,[cd.TryGetValue(cg,{get:function(){return ci;},set:function(cj){ci=cj;}}),ci]);return ch[0]?ch[1].$==0?{$:1,$0:ch[1].$1}:ch[1].$==1?{$:1,$0:bg.TextNode(ch[1].$1)}:ch[1].$==2?{$:1,$0:bg.TextView(ch[1].$1)}:ch[1].$==8?{$:1,$0:bg.TextView(ch[1].$1.get_View())}:ch[1].$==9?{$:1,$0:bg.TextView(y.Map(a.String,ch[1].$1.get_View()))}:ch[1].$==10?{$:1,$0:bg.TextView(y.Map(function(cj){return cj.get_Input();},ch[1].$1.get_View()))}:ch[1].$==11?{$:1,$0:bg.TextView(y.Map(a.String,ch[1].$1.get_View()))}:ch[1].$==12?{$:1,$0:bg.TextView(y.Map(function(cj){return cj.get_Input();},ch[1].$1.get_View()))}:ch[1].$==13?{$:1,$0:bg.TextView(y.Map(a.String,ch[1].$1.get_View()))}:(bM.warn("Content hole filled with attribute data",cg),null):null;}b$=[];ca=[];cb=[];cc=[];cd=new bT.New$5();ce=bE.Get(b4);try{while(ce.MoveNext()){cf=ce.Current();cd.set_Item(cf.$0,cf);}}finally{if(typeof ce=="object"&&"Dispose"in ce)ce.Dispose();}b5=r.ChildrenArray(b3);bk.foreachNotPreserved(b3,"[ws-hole]",function(cg){var ch,ci,cj;cj=cg.getAttribute("ws-hole");cg.removeAttribute("ws-hole");while(cg.hasChildNodes())cg.removeChild(cg.lastChild);ch=b_(cj);if(ch!=null&&ch.$==1){ci=ch.$0;bf.LinkElement(cg,ci.docNode);b$.push(ba.New(_6.Empty(cg),ci.docNode,null,cg,h.Int(),null));ca.push(ci.updates);}});bk.foreachNotPreserved(b3,"[ws-replace]",function(cg){var ch,ci,cj,ck,cl,cm;ch=b_(cg.getAttribute("ws-replace"));if(ch!=null&&ch.$==1){ci=ch.$0;cj=cg.parentNode;ck=self.document.createTextNode("");cj.replaceChild(ck,cg);cl=bf.InsertBeforeDelim(ck,ci.docNode);cm=bD.tryFindIndex(function(cn){return cg===cn;},b5);cm==null?void 0:bD.set(b5,cm.$0,ci.docNode);b$.push(ba.New(_6.Empty(cj),ci.docNode,{$:1,$0:[cl,ck]},cj,h.Int(),null));ca.push(ci.updates);}});bk.foreachNotPreserved(b3,"[ws-attr]",function(cg){var ch,ci,cj;ch=cg.getAttribute("ws-attr");cg.removeAttribute("ws-attr");ci=(cj=null,[cd.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);if(ci[0])ci[1].$==3?b9(cg,ci[1].$1):bM.warn("Attribute hole filled with non-attribute data",ch);});bk.foreachNotPreserved(b3,"[ws-on]",function(cg){b9(cg,_2.Concat(bD.choose(function(ch){var ci,cj,ck;ci=bF.SplitChars(ch,[":"],1);cj=(ck=null,[cd.TryGetValue(bD.get(ci,1),{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);return cj[0]?cj[1].$==4?{$:1,$0:_9.Handler(bD.get(ci,0),cj[1].$1)}:cj[1].$==5?{$:1,$0:_2.Handler(bD.get(ci,0),cj[1].$1)}:(bM.warn("Event hole on"+bD.get(ci,0)+" filled with non-event data",bD.get(ci,1)),null):null;},bF.SplitChars(cg.getAttribute("ws-on"),[" "],1))));cg.removeAttribute("ws-on");});bk.foreachNotPreserved(b3,"[ws-onafterrender]",function(cg){var ch,ci,cj;ch=cg.getAttribute("ws-onafterrender");ci=(cj=null,[cd.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);if(ci[0])ci[1].$==6?(cg.removeAttribute("ws-onafterrender"),b9(cg,_9.OnAfterRender(ci[1].$1))):ci[1].$==7?(cg.removeAttribute("ws-onafterrender"),b9(cg,_9.OnAfterRender(ci[1].$1))):bM.warn("onafterrender hole filled with non-onafterrender data",ch);});bk.foreachNotPreserved(b3,"[ws-var]",function(cg){var ch,ci,cj;ch=cg.getAttribute("ws-var");cg.removeAttribute("ws-var");ci=(cj=null,[cd.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);if(ci[0])ci[1].$==8?b9(cg,_9.Value(ci[1].$1)):ci[1].$==9?b9(cg,_9.Checked(ci[1].$1)):ci[1].$==10?b9(cg,_9.IntValue(ci[1].$1)):ci[1].$==11?b9(cg,_9.IntValueUnchecked(ci[1].$1)):ci[1].$==12?b9(cg,_9.FloatValue(ci[1].$1)):ci[1].$==13?b9(cg,_9.FloatValueUnchecked(ci[1].$1)):bM.warn("Var hole filled with non-Var data",ch);});bk.foreachNotPreserved(b3,"[ws-attr-holes]",function(cg){var ch,ci,cj,ck;ch=new a.RegExp(bk.TextHoleRE(),"g");ci=bF.SplitChars(cg.getAttribute("ws-attr-holes"),[" "],1);cg.removeAttribute("ws-attr-holes");for(cj=0,ck=ci.length-1;cj<=ck;cj++)(function(){var cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx;cu=bD.get(ci,cj);cv=cg.getAttribute(cu);cl=null;cm=0;cw=[];while(cl=ch.exec(cv),cl!==null){cx=bX.string(cv,{$:1,$0:cm},{$:1,$0:ch.lastIndex-bD.get(cl,0).length-1});cm=ch.lastIndex;cw.push([cx,bD.get(cl,1)]);}co=bX.string(cv,{$:1,$0:cm},null);ch.lastIndex=0;cp=bD.foldBack(function(cy,cz){return(function(cA){var cB,cC;cB=cA[0];cC=cA[1];return function(cD){var cE,cF,cG,cH,cI;cE=cD[0];cF=cD[1];cG=(cH=(cI=null,[cd.TryGetValue(cC,{get:function(){return cI;},set:function(cJ){cI=cJ;}}),cI]),cH[0]?cH[1].$==1?{$:0,$0:cH[1].$1}:cH[1].$==2?{$:1,$0:cH[1].$1}:cH[1].$==8?{$:1,$0:cH[1].$1.get_View()}:cH[1].$==9?{$:1,$0:y.Map(a.String,cH[1].$1.get_View())}:cH[1].$==10?{$:1,$0:y.Map(function(cJ){return cJ.get_Input();},cH[1].$1.get_View())}:cH[1].$==11?{$:1,$0:y.Map(a.String,cH[1].$1.get_View())}:cH[1].$==12?{$:1,$0:y.Map(function(cJ){return cJ.get_Input();},cH[1].$1.get_View())}:cH[1].$==13?{$:1,$0:y.Map(a.String,cH[1].$1.get_View())}:(bM.warn("Attribute value hole filled with non-text data",cC),{$:0,$0:""}):{$:0,$0:""});return cG.$==1?[cB,new bC.T({$:1,$0:cE===""?cG.$0:y.Map(function(cJ){return cJ+cE;},cG.$0),$1:cF})]:[cB+cG.$0+cE,cF];};}(cy))(cz);},cw,[co,bC.T.Empty]);return b9(cg,cp[1].$==1?cp[1].$1.$==1?cp[1].$1.$1.$==1?cp[1].$1.$1.$1.$==0?(cq=cp[0],_9.Dynamic(cu,y.Map3(function(cy,cz,cA){return cq+cy+cz+cA;},cp[1].$0,cp[1].$1.$0,cp[1].$1.$1.$0))):(cr=cp[0],_9.Dynamic(cu,y.Map(function(cy){return cr+bF.concat("",cy);},y.Sequence(cp[1])))):(cs=cp[0],_9.Dynamic(cu,y.Map2(function(cy,cz){return cs+cy+cz;},cp[1].$0,cp[1].$1.$0))):cp[0]===""?_9.Dynamic(cu,cp[1].$0):(ct=cp[0],_9.Dynamic(cu,y.Map(function(cy){return ct+cy;},cp[1].$0))):_2.Create(cu,cp[0]));}());});return[bK.DeleteEmptyFields({Els:b5,Dirty:true,Holes:b$,Attrs:cb,Render:(b6=cc.length==0?null:{$:1,$0:function(cg){bD.iter(function(ch){ch(cg);},cc);}},b6?b6.$0:void 0),El:(b7=!bL.Equals(b5,null)&&b5.length===1&&(bD.get(b5,0)instanceof bW&&(bD.get(b5,0)instanceof a.Element&&(b8=bD.get(b5,0),true)))?{$:1,$0:b8}:null,b7?b7.$0:void 0)},["Render","El"]),d.TreeReduce(y.Const(),y.Map2Unit,ca)];};bk.foreachNotPreserved=function(b3,b4,b5){r.IterSelector(b3,b4,function(b6){if(b6.closest("[ws-preserve]")==null)b5(b6);});};bk.TextHoleRE=function(){bm.$cctor();return bm.TextHoleRE;};bk.GlobalHoles=function(){bm.$cctor();return bm.GlobalHoles;};bk.set_GlobalHoles=function(b3){bm.$cctor();bm.GlobalHoles=b3;};bk.LocalTemplatesLoaded=function(){bm.$cctor();return bm.LocalTemplatesLoaded;};bk.set_LocalTemplatesLoaded=function(b3){bm.$cctor();bm.LocalTemplatesLoaded=b3;};bk.LoadedTemplateFile=function(b3){var b4,b5,b6;b4=(b5=null,[bk.LoadedTemplates().TryGetValue(b3,{get:function(){return b5;},set:function(b7){b5=b7;}}),b5]);return b4[0]?b4[1]:(b6=new bT.New$5(),(bk.LoadedTemplates().set_Item(b3,b6),b6));};bk.LoadedTemplates=function(){bm.$cctor();return bm.LoadedTemplates;};bm.$cctor=function(){bm.$cctor=a.ignore;bm.LoadedTemplates=new bT.New$5();bm.LocalTemplatesLoaded=false;bm.GlobalHoles=new bT.New$5();bm.TextHoleRE="\\${([^}]+)}";bm.RenderedFullDocTemplate=null;};bn=c.Flow=bK.Class({get_Render:function(){return this.render;}},k,bn);bn.New=bK.Ctor(function(b3){bn.New$1.call(this,function(b4){return function(b5){return A.Set(b4,b3(b5));};});},bn);bn.New$1=bK.Ctor(function(b3){k.New.call(this);this.render=b3;},bn);bn.get_Do=function(){return new bo.New();};bn.Static=function(b3){return new bn.New$1(function(b4){return function(b5){A.Set(b4,b3);return b5();};});};bn.Define=function(b3){return new bn.New(function(b4){return b3(function(b5){b4(b5);});});};bn.Embed=function(b3){var b4;b4=A.Create$1(bg.get_Empty());((b3.get_Render())(b4))(a.ignore);return bg.EmbedView(b4.get_View());};bn.Return=function(b3){return new bn.New$1(function(){return function(b4){return b4(b3);};});};bn.Bind=function(b3,b4){return new bn.New$1(function(b5){return function(b6){return((b3.get_Render())(b5))(function(b7){((b4(b7).get_Render())(b5))(b6);});};});};bn.Map=function(b3,b4){return new bn.New$1(function(b5){return function(b6){return((b4.get_Render())(b5))(function(b7){b6(b3(b7));});};});};bo=c.FlowBuilder=bK.Class({ReturnFrom:a.id,Return:function(b3){return bn.Return(b3);},Bind:function(b3,b4){return bn.Bind(b3,b4);}},k,bo);bo.New=bK.Ctor(function(){k.New.call(this);},bo);bq=bp.attr=bK.Class({},k,bq);bq.New=bK.Ctor(function(){k.New.call(this);},bq);br.InstallHash=function(b3,b4){var b5;b5=A.Create$1(void 0);br.InstallHashInto(b5,b3,b4);return b5;};br.InstallHashInto=function(b3,b4,b5){function b6(b9){return bZ.Parse(b5,b0.FromHash(b9,{$:1,$0:true}));}function b7(){return br.getCurrentHash(b6,b4);}function b8(b9){if(!bL.Equals(b3.Get(),b9))b3.Set(b9);}b8(b7());self.addEventListener("popstate",function(){return b8(b7());},false);self.addEventListener("hashchange",function(){return b8(b7());},false);self.document.body.addEventListener("click",function(b9){var b_,b$,ca;b_=(b$=br.findLinkHref(b9.target),b$==null?null:(ca=b$.$0,bF.StartsWith(ca,"#")?b6(ca):null));return b_==null?null:(b8(b_.$0),b9.preventDefault());},false);y.Sink(function(b9){var b_;if(!bL.Equals(b9,b7())){b_=bZ.HashLink(b5,b9);self.history.pushState(null,null,b_);}},b3.get_View());};br.getCurrentHash=function(b3,b4){var b5,b6;b5=self.location.hash;b6=b3(b5);return b6==null?((function(b7){return function(b8){return b7("Failed to parse route: "+b1.toSafe(b8));};}(function(b7){bM.log(b7);}))(b5),b4):b6.$0;};br.Install=function(b3,b4){var b5;b5=A.Create$1(void 0);br.InstallInto(b5,b3,b4);return b5;};br.InstallInto=function(b3,b4,b5){function b6(b9){return bZ.Parse(b5,b9);}function b7(){return br.getCurrent(b6,b4);}function b8(b9){if(!bL.Equals(b3.Get(),b9))b3.Set(b9);}b8(b7());self.addEventListener("popstate",function(){return b8(b7());},false);self.document.body.addEventListener("click",function(b9){var b_,b$,ca;b_=(b$=(ca=br.findLinkHref(b9.target),ca==null?null:br.hrefToAbsolute(ca.$0)),b$==null?null:b6(b0.FromUrl(b$.$0,null)));return b_==null?null:(b8(b_.$0),b9.preventDefault());},false);y.Sink(function(b9){var b_;if(!bL.Equals(b9,b7())){b_=bZ.Link(b5,b9);self.history.pushState(null,null,b_);}},b3.get_View());};br.findLinkHref=function(b3){while(true)if(b3.tagName==="A")return b2.ofObj(b3.getAttribute("href"));else if(b3===self.document.body)return null;else b3=b3.parentNode;};br.hrefToAbsolute=function(b3){var b4;return bF.StartsWith(b3,"?")?{$:1,$0:br.trimFragment(self.location.pathname+b3)}:bF.StartsWith(b3,"#")?null:bF.StartsWith(b3,"/")?{$:1,$0:br.trimFragment(b3)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(b3)?null:(b4=self.location.pathname,{$:1,$0:br.trimFragment(bX.string(b4,null,{$:1,$0:b4.lastIndexOf("/")})+b3)});};br.trimFragment=function(b3){var b4;b4=b3.indexOf("#");return b4===-1?b3:bX.string(b3,null,{$:1,$0:b4-1});};br.getCurrent=function(b3,b4){var b5,b6,b7;b5=self.location;b6=b0.FromUrl(b5.pathname+b5.search,null);b7=b3(b6);return b7==null?((function(b8){return function(b9){return b8("Failed to parse route: "+b1.toSafe(b9));};}(function(b8){bM.log(b8);}))(b6.ToLink()),b4):b7.$0;};bs.Append=function(b3,b4){return{$:0,$0:p.Append(b3.$0,b4.$0),$1:bO.FoldBack(function(b5,b6,b7){return b7.Add$1(b5,b6);},b3.$1,b4.$1)};};bs.FromList=function(b3,b4){return{$:0,$0:p.FromArray(bD.ofList(b3)),$1:b4};};bs.ToList=function(b3){return[bC.ofArray(p.ToArray(b3.$0)),b3.$1];};bs.SameHash=function(b3,b4){return bs.NoHash(b3)===bs.NoHash(b4);};bs.MakeHash=function(b3){var b4,b5;b4=b3.$1;b5=bF.concat("/",bD.map(function(b6){return a.encodeURIComponent(b6);},p.ToArray(b3.$0)));return b4.get_IsEmpty()?b5:b5+"?"+bF.concat("&",bJ.map(function(b6){var b7;b7=bQ.KeyValue(b6);return a.encodeURIComponent(b7[0])+"="+a.encodeURIComponent(b7[1]);},b4));};bs.ParseHash=function(b3){var b4,b5,b6,b7;b4=bs.NoHash(b3);b5=(b6=b4.indexOf("?"),b6===-1?[b4,""]:[bX.string(b4,null,{$:1,$0:b6-1}),bX.string(b4,{$:1,$0:b6+1},null)]);b7=b5[0];return{$:0,$0:p.FromArray(b7===""?[]:bD.map(function(b8){return a.decodeURIComponent(b8);},bF.SplitChars(b7,["/"],0))),$1:bO.OfArray(bD.map(function(b8){var b9;b9=b8.indexOf("=");return b9===-1?[a.decodeURIComponent(b8),""]:[a.decodeURIComponent(bX.string(b8,null,{$:1,$0:b9-1})),a.decodeURIComponent(bX.string(b8,{$:1,$0:b9+1},null))];},bF.SplitChars(b5[1],["&"],0)))};};bs.NoHash=function(b3){return bF.StartsWith(b3,"#")?b3.substring(1):b3;};bt.DoLink=function(b3,b4){var b5;b5=b3.Ser(b4);return bs.FromList(b5[0],b5[1]);};bt.DoRoute=function(b3,b4){return b3.Des(bs.ToList(b4));};bt.InstallMap=function(b3){var b4;function b5(b9,b_){return bL.Equals(b3.Ser(b9),b3.Ser(b_));}function b6(){return b3.Des(bs.ToList(bs.ParseHash(self.location.hash)));}function b7(b9){if(!b5(b4.Get(),b9))b4.Set(b9);}function b8(b9){return b7(b6());}b4=A.Create$1(b6());self.onpopstate=b8;self.onhashchange=b8;y.Sink(function(b9){var b_,b$;b_=bs.MakeHash((b$=b3.Ser(b9),bs.FromList(b$[0],b$[1])));if(!bs.SameHash(self.location.hash,b_))self.location.replace("#"+b_);},b4.get_View());return b4;};bu.Install=function(b3){return bt.InstallMap(b3);};bu.Create=function(b3,b4){function b5(b6){return b6[0];}return{Des:function(b6){return b4(b5(b6));},Ser:function(b6){return[b3(b6),new bP.New([])];}};};bu.CreateWithQuery=function(b3,b4){return{Des:b4,Ser:b3};};bw.New=function(b3,b4){return{Active:b3,PosV:b4};};bx.New=function(b3,b4,b5,b6){return{Active:b3,Left:b4,Middle:b5,Right:b6};};by.get_MousePressed=function(){bv.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bK.Curried3(function(b3,b4,b5){return b3||b4||b5;})),bv.MouseBtnSt$1().Left.get_View()),bv.MouseBtnSt$1().Middle.get_View()),bv.MouseBtnSt$1().Right.get_View());};by.get_RightPressed=function(){bv.ActivateButtonListener();return bv.MouseBtnSt$1().Right.get_View();};by.get_MiddlePressed=function(){bv.ActivateButtonListener();return bv.MouseBtnSt$1().Middle.get_View();};by.get_LeftPressed=function(){bv.ActivateButtonListener();return bv.MouseBtnSt$1().Left.get_View();};by.get_Position=function(){!bv.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(b3){return A.Set(bv.MousePosSt$1().PosV,[b3.clientX,b3.clientY]);}),bv.MousePosSt$1().Active=true):void 0;return bv.MousePosSt$1().PosV.get_View();};bz.New=function(b3,b4,b5){return{KeysPressed:b3,KeyListenerActive:b4,LastPressed:b5};};bA.IsPressed=function(b3){function b4(b5){return b5===b3;}bv.ActivateKeyListener();return y.Map(function(b5){return bC.exists(b4,b5);},bv.KeyListenerState().KeysPressed.get_View());};bA.get_LastPressed=function(){bv.ActivateKeyListener();return bv.KeyListenerState().LastPressed.get_View();};bA.get_KeysPressed=function(){bv.ActivateKeyListener();return bv.KeyListenerState().KeysPressed.get_View();};bv.ActivateKeyListener=function(){bB.$cctor();return bB.ActivateKeyListener;};bv.KeyListenerState=function(){bB.$cctor();return bB.KeyListenerState;};bv.ActivateButtonListener=function(){bB.$cctor();return bB.ActivateButtonListener;};bv.MouseBtnSt$1=function(){bB.$cctor();return bB.MouseBtnSt;};bv.MousePosSt$1=function(){bB.$cctor();return bB.MousePosSt;};bB.$cctor=function(){bB.$cctor=a.ignore;function b3(b4,b5){var b6;b6=b4.button;return b6===0?A.Set(bv.MouseBtnSt$1().Left,b5):b6===1?A.Set(bv.MouseBtnSt$1().Middle,b5):b6===2?A.Set(bv.MouseBtnSt$1().Right,b5):null;}bB.MousePosSt=bw.New(false,A.Create$1([0,0]));bB.MouseBtnSt=bx.New(false,A.Create$1(false),A.Create$1(false),A.Create$1(false));bB.ActivateButtonListener=!bv.MouseBtnSt$1().Active?(bv.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(b4){return b3(b4,true);}),self.document.addEventListener("mouseup",function(b4){return b3(b4,false);})):null;bB.KeyListenerState=bz.New(A.Create$1(bC.T.Empty),false,A.Create$1(-1));bB.ActivateKeyListener=!bv.KeyListenerState().KeyListenerActive?(bv.KeyListenerState().KeyListenerActive=true,self.document.addEventListener("keydown",function(b4){var b5,b6,b7;b5=b4.which;b6=b5===null?b4.keyCode:b5;A.Set(bv.KeyListenerState().LastPressed,b6);b7=bv.KeyListenerState().KeysPressed.Get();return!bC.exists(function(b8){return b8===b6;},b7)?bv.KeyListenerState().KeysPressed.Set(bC.append(b7,bC.ofArray([b6]))):null;}),self.document.addEventListener("keyup",function(b4){var b5,b6;function b7(b8){return b8!==b6;}b5=b4.which;b6=b5===null?b4.keyCode:b5;return A.Update(bv.KeyListenerState().KeysPressed,function(b8){return bC.filter(b7,b8);});})):null;};}(self));
